# 4. S√§kerhet och √∂vervakning

## 4.3 √ñvervakning och loggning

### 4.3.1 Varf√∂r loggar och √∂vervakar man?

√ñvervakning och loggning handlar om synlighet: att kunna svara p√• vad h√§nde, n√§r, var, och av vem ‚Äì och att uppt√§cka n√§r n√•got avviker innan det blir ett driftstopp eller en incident. Loggar √§r dessutom bevismaterial n√§r n√•got m√•ste utredas i efterhand. Tv√• praktiska f√∂ruts√§ttningar b√§r hela omr√•det: tidssynk (utan gemensam klocka g√•r det inte att korrelera h√§ndelser) och centralisering (att samla loggar p√• en plats d√§r de kan s√∂kas, korreleras och larma).

I ett modernt n√§t √§r loggk√§llorna m√•nga: klienter och servrar, n√§tverksutrustning (switchar, routrar, brandv√§ggar, WLAN-kontroller), katalogtj√§nster (AD/LDAP), DNS/DHCP, applikationer och identitetstj√§nster. Po√§ngen √§r inte att ‚Äúlogga allt‚Äù, utan att logga r√§tt saker med lagom detaljer ‚Äì och ha en tydlig √§gare som faktiskt tittar p√• signalerna.

F√∂rtydligande (sammanfattning):

- Synlighet: loggar = svar p√• ‚Äúvad, n√§r, var, vem‚Äù.
- Grundkrav: tidssynk och centralisering.
- Urval: logga det som beh√∂vs f√∂r att se avvikelser och fels√∂ka ‚Äì inte allt.

Synlighet: loggar = svar p√• ‚Äúvad, n√§r, var, vem‚Äù.

Grundkrav: tidssynk och centralisering.

Urval: logga det som beh√∂vs f√∂r att se avvikelser och fels√∂ka ‚Äì inte allt.

Exempel: En kort driftst√∂rning i inloggning sp√•ras p√• minuter tack vare gemensamma tidsst√§mplar: DNS-logg visar misslyckat uppslag, brandv√§ggslogg visar blockerat fl√∂de mot extern resolver, AD-logg visar √∂kade autentiseringsfel ‚Äì kedjan blir tydlig och √•tg√§rdas.

### 4.3.2 Logghantering: Event Viewer (Windows), syslog (Unix/Linux/n√§t)

Windows loggar till Event Viewer (H√§ndelsevisaren) i kanaler som System, Application, Security och applikationsspecifika loggar. H√§ndelser har niv√•er (Information/Warning/Error/Critical), k√§llor och ofta h√§ndelse-ID som g√∂r dem s√∂kbara. S√§kerhetsloggar (t.ex. inloggning, grupp√§ndringar, policy) blir v√§ldigt anv√§ndbara n√§r de korreleras med n√§t- och applikationsloggar.

Unix/Linux och n√§tutrustning anv√§nder oftast syslog ‚Äì ett standardprotokoll och ett format f√∂r loggar. Syslog har facility (vilken del av systemet) och severity (emerg, alert, crit, err, warning, notice, info, debug). P√• Linux skrivs loggar numera ofta till systemd-journald (den bin√§ra journalen), och skickas d√§rifr√•n vidare till en syslog-tj√§nst (t.ex. rsyslog/syslog-ng) f√∂r central insamling. N√§tutrustning skickar syslog direkt till en central loggserver. UDP/514 √§r klassiskt, men TCP/TLS b√∂r anv√§ndas n√§r det √§r m√∂jligt f√∂r att undvika tapp och skydda inneh√•ll.

F√∂r att loggar ska vara anv√§ndbara beh√∂vs ocks√•: namnstandarder (v√§rdnamn som g√•r att tolka), loggrotation och retention (hur l√§nge sparas vad), √•tkomstkontroll (vem f√•r l√§sa), samt normalisering (g√∂ra olika k√§llor j√§mf√∂rbara) i den centrala plattformen.

F√∂rtydligande (sammanfattning):

- Windows: Event Viewer med kanaler, niv√•er, event-ID.
- Unix/Linux & n√§t: syslog (facility/severity) + ofta journald p√• Linux.
- Praktik: TLS/TCP n√§r det g√•r, tydliga namn, genomt√§nkt retention och r√§ttigheter.

Windows: Event Viewer med kanaler, niv√•er, event-ID.

Unix/Linux & n√§t: syslog (facility/severity) + ofta journald p√• Linux.

Praktik: TLS/TCP n√§r det g√•r, tydliga namn, genomt√§nkt retention och r√§ttigheter.

Exempel: En switchport ‚Äúflappar‚Äù (g√•r upp/ner). Syslog fr√•n switchen visar portens status√§ndringar, Event Viewer p√• filservern visar samtidigt tappade n√§tverksresurser. Tidslinjen kopplar ihop h√§ndelserna och g√∂r felet l√§tt att lokalisera.

### 4.3.3 Verktyg: Wazuh, SNMP, SIEM

Wazuh √§r en √∂ppen plattform f√∂r s√§kerhets√∂vervakning som kombinerar logginsamling med funktioner som FIM (File Integrity Monitoring), s√•rbarhets-indikering och regelbaserade larm. Den anv√§nder agenter (p√• klient/servrar) men kan ocks√• ta emot loggar via syslog. Vanligt √§r att lagra/s√∂ka i en Elastic/OpenSearch-stack med f√§rdiga instrumentpaneler. Po√§ngen √§r att f√• sammanhang: ‚Äúdenna fil √§ndrades, p√• denna v√§rd, direkt efter denna inloggning‚Äù.

SNMP (Simple Network Management Protocol) √§r n√§tutrustningens telemetri. Med GET kan man l√§sa m√§tv√§rden (interfacestatistik, CPU, temperatur), med TRAP/INFORM skickar enheten h√§ndelser proaktivt (l√§nk ner/upp, fl√§ktfel, √∂verhettning). MIB/OID beskriver vad som kan l√§sas. Version SNMPv3 ger autentisering och kryptering (till skillnad fr√•n v1/v2c som anv√§nder community-str√§ngar). I √∂vervakning utg√∂r SNMP ‚Äúh√§lsopulsen‚Äù som kompletterar loggar.

SIEM (Security Information and Event Management) √§r den centrala plattformen som samlar, normaliserar, korrelerar och larmar p√• tv√§rs av k√§llor: serverloggar, n√§tfl√∂den, AD-h√§ndelser, brandv√§gg, DNS, proxy. Exempel p√• funktioner: korrelationsregler (‚Äúm√•nga misslyckade inloggningar + lyckad fr√•n ovanlig klient‚Äù), dashboard med indikatorer, larmhantering och playbooks f√∂r √•tg√§rd. SIEM √§r inte lika med ‚Äúdyra licenser‚Äù ‚Äì principen kan uppn√•s med b√•de √∂ppna och kommersiella byggstenar ‚Äì men tidsst√§mplar, normalisering och √§garskap √§r alltid avg√∂rande.

F√∂rtydligande (sammanfattning):

- Wazuh: agent + regler + dashboards; binder ihop fil/host/n√§t-h√§ndelser.
- SNMP: m√§tv√§rden och traps fr√•n n√§t- och infrastruktur; SNMPv3 f√∂r s√§kerhet.
- SIEM: central hj√§rna f√∂r insamling, korrelation och larm.

Wazuh: agent + regler + dashboards; binder ihop fil/host/n√§t-h√§ndelser.

SNMP: m√§tv√§rden och traps fr√•n n√§t- och infrastruktur; SNMPv3 f√∂r s√§kerhet.

SIEM: central hj√§rna f√∂r insamling, korrelation och larm.

Exempel: SNMP visar √∂kande felr√§knare p√• ett switchinterface; Wazuh larmar samtidigt om ovanligt m√•nga TCP-√•terf√∂rs√∂k p√• en server i samma VLAN. SIEM visar korrelationen p√• en tidslinje ‚Äì felet ligger p√• l√§nken mellan dem, inte i applikationen.

### 4.3.4 Att tolka loggar och uppt√§cka avvikelser

Loggar blir meningsfulla n√§r de s√§tts i sammanhang. Ett fungerande arbetss√§tt b√∂rjar med en fr√•ga (‚Äúvarf√∂r √§r inloggning l√•ngsam?‚Äù, ‚Äúvem skapade denna delning?‚Äù), v√§ljer k√§llor (AD/brandv√§gg/klient), och binder ihop h√§ndelser via tidsst√§mplar och identiteter (anv√§ndare, v√§rd, IP, process). Tv√• v√§gar anv√§nds parallellt:

- Regel- och tr√∂skelbaserat: ‚Äú>10 misslyckade inloggningar (Windows Event ID) fr√•n samma IP p√• 5 min‚Äù ‚Üí bruteforce-indikator; ‚Äúny medlem i lokal admins‚Äù ‚Üí larma.
- Avvikelsebaserat: ‚Äúdenna klient g√∂r pl√∂tsligt tusentals DNS-fr√•gor mot externa dom√§ner‚Äù eller ‚Äúden h√§r servern pratar ut p√• en port den aldrig anv√§nt‚Äù.

Regel- och tr√∂skelbaserat: ‚Äú>10 misslyckade inloggningar (Windows Event ID) fr√•n samma IP p√• 5 min‚Äù ‚Üí bruteforce-indikator; ‚Äúny medlem i lokal admins‚Äù ‚Üí larma.

Avvikelsebaserat: ‚Äúdenna klient g√∂r pl√∂tsligt tusentals DNS-fr√•gor mot externa dom√§ner‚Äù eller ‚Äúden h√§r servern pratar ut p√• en port den aldrig anv√§nt‚Äù.

B√•da kr√§ver baslinjer: hur ‚Äúser normalt ut‚Äù? Utan baslinje blir allt antingen larm eller brus. D√§rf√∂r finjusteras regler (tr√∂sklar, suppressionsf√∂nster, deduplicering) tills larmen √§r f√• men viktiga. Och varje ‚Äúr√∂tt larm‚Äù beh√∂ver en runbook: vem √§ger det, vilka steg tas, n√§r eskaleras?

F√∂rtydligande (sammanfattning):

- Fr√•gedriven metod: fr√•ga ‚Üí k√§llor ‚Üí korrelation ‚Üí slutsats.
- Tv√• blickar: regler/tr√∂sklar och avvikelse/baslinje.
- Tuning: tr√∂sklar, dedup, suppression; runbooks f√∂r √•tg√§rd.

Fr√•gedriven metod: fr√•ga ‚Üí k√§llor ‚Üí korrelation ‚Üí slutsats.

Tv√• blickar: regler/tr√∂sklar och avvikelse/baslinje.

Tuning: tr√∂sklar, dedup, suppression; runbooks f√∂r √•tg√§rd.

Exempel: SIEM larmar: ‚ÄúM√•nga misslyckade inloggningar f√∂ljt av en lyckad (samma konto), d√§refter ny RDP-session fr√•n ovanlig klient‚Äù. Korrelation med AD-logg visar att kontot lades till i en lokal admin-grupp ‚Äî en tydlig kedja som stoppas genom att sp√§rra kontot och rulla l√∂senord/nycklar.

### 4.3.5 Larm, brus och ansvar (vem g√∂r vad n√§r det blinkar?)

Ett √∂vervakningssystem utan √§gare blir snabbt en ‚Äúblinkande tavla‚Äù. Definiera allvarsniv√•er, SLA f√∂r hantering (t.ex. kritiskt = 15 minuter till √•tg√§rd), och v√§gar f√∂r eskalering. Arbeta bort falskpositiv genom att justera regler, l√§gga undantag f√∂r k√§nda m√∂nster och tidsbegr√§nsa undertryckning. Testa larmkedjan med table-top-√∂vningar och simulera verkliga h√§ndelser (t.ex. m√•nga misslyckade logins) f√∂r att se att kedjan h√•ller.

F√∂rtydligande (sammanfattning):

- S√§tt niv√•er och tider: s√• vet alla vad som f√∂rv√§ntas.
- Minska brus: justera, vitlista k√§nda m√∂nster, f√∂lj upp.
- √ñva: simuleringar visar var kedjan brister.

S√§tt niv√•er och tider: s√• vet alla vad som f√∂rv√§ntas.

Minska brus: justera, vitlista k√§nda m√∂nster, f√∂lj upp.

√ñva: simuleringar visar var kedjan brister.

Exempel: Ett ‚Äústormlarm‚Äù om misslyckade inloggningar visar sig bero p√• l√∂senordsbyte i en klass. En suppression-regel inf√∂rs (1 h f√∂r just den k√§llan), men ett separat larm ligger kvar f√∂r inloggningar fr√•n internet ‚Äì s√• att verkliga f√∂rs√∂k inte tystas.

### 4.3.6 Dataskydd och etik

Loggar kan inneh√•lla personuppgifter (anv√§ndarnamn, IP, tid, ibland filnamn). Det g√∂r dataminimering, beh√∂righetsstyrning, retention och syftesbeskrivning viktiga. Loggar ska skyddas lika omsorgsfullt som andra system och bara vara tillg√§ngliga f√∂r dem som beh√∂ver dem i sitt arbete.

F√∂rtydligande (sammanfattning):

- Minimera: samla det som beh√∂vs ‚Äì inte mer.
- Skydda: √•tkomstkontroll, kryptering, revision.
- Rensa: retention kopplad till syfte och lagkrav.

Minimera: samla det som beh√∂vs ‚Äì inte mer.

Skydda: √•tkomstkontroll, kryptering, revision.

Rensa: retention kopplad till syfte och lagkrav.

Exempel: S√§kerhetsloggar sparas 12 m√•nader f√∂r incidentutredning och revisionskrav; applikationsloggar med personn√§ra data rensas efter 30 dagar. √Ötkomst till SIEM √§r gruppstyrd och loggas.

### üìå Kontrollfr√•gor

- Varf√∂r √§r tidssynk och centralisering grundl√§ggande f√∂r anv√§ndbara loggar?
- Vilka √§r de viktigaste skillnaderna mellan Event Viewer och syslog?
- Vad g√∂r SNMP (Simple Network Management Protocol) i √∂vervakning, och varf√∂r f√∂redras SNMPv3?
- Beskriv hur Wazuh kan ge sammanhang mellan loggar, fil√§ndringar och inloggningar.
- Vad betyder SIEM (Security Information and Event Management) i praktiken ‚Äì vilka tre saker g√∂r ett SIEM alltid?
- Ge exempel p√• en regelbaserad respektive en avvikelsebaserad detektion.
- Varf√∂r beh√∂vs baslinjer och hur p√•verkar de antalet falsklarm?
- Vad √§r en runbook, och varf√∂r √§r den central n√§r ett larm g√•r?
- N√§mn tre beslut man m√•ste ta kring retention och √•tkomst till loggar.
- Vad b√∂r loggas f√∂r att kunna utreda ‚Äúpl√∂tsligt l√•ngsam inloggning‚Äù utan att samla on√∂digt inneh√•ll?

Varf√∂r √§r tidssynk och centralisering grundl√§ggande f√∂r anv√§ndbara loggar?

Vilka √§r de viktigaste skillnaderna mellan Event Viewer och syslog?

Vad g√∂r SNMP (Simple Network Management Protocol) i √∂vervakning, och varf√∂r f√∂redras SNMPv3?

Beskriv hur Wazuh kan ge sammanhang mellan loggar, fil√§ndringar och inloggningar.

Vad betyder SIEM (Security Information and Event Management) i praktiken ‚Äì vilka tre saker g√∂r ett SIEM alltid?

Ge exempel p√• en regelbaserad respektive en avvikelsebaserad detektion.

Varf√∂r beh√∂vs baslinjer och hur p√•verkar de antalet falsklarm?

Vad √§r en runbook, och varf√∂r √§r den central n√§r ett larm g√•r?

N√§mn tre beslut man m√•ste ta kring retention och √•tkomst till loggar.

Vad b√∂r loggas f√∂r att kunna utreda ‚Äúpl√∂tsligt l√•ngsam inloggning‚Äù utan att samla on√∂digt inneh√•ll?

### 

### üîó F√∂rdjupningsl√§nkar

- Microsoft ‚Äì Event Viewer (√∂versikt): https://learn.microsoft.com/windows/client-management/troubleshoot-event-viewer
- systemd-journald (man-sida): https://www.freedesktop.org/software/systemd/man/latest/systemd-journald.service.html
- rsyslog ‚Äì dokumentation: https://www.rsyslog.com/doc/
- IETF ‚Äì Syslog Protocol (RFC 5424): https://www.rfc-editor.org/rfc/rfc5424
- SNMPv3 ‚Äì √∂versikt (Cisco): https://www.cisco.com/c/en/us/tech/snmp/
- Wazuh ‚Äì dokumentation: https://documentation.wazuh.com/
- Elastic Security (SIEM-koncept, √∂versikt): https://www.elastic.co/security/siem
- Microsoft Sentinel (SIEM/SOAR-koncept, √∂versikt): https://learn.microsoft.com/azure/sentinel/overview
- FIRST ‚Äì Common Event Expression & Logging best practices: https://www.first.org/cvss/user-guide & https://www.first.org/resources/papers/logging
- NIST ‚Äì Guide to Computer Security Log Management (SP 800-92): https://csrc.nist.gov/publications/detail/sp/800-92/final

Microsoft ‚Äì Event Viewer (√∂versikt): https://learn.microsoft.com/windows/client-management/troubleshoot-event-viewer

systemd-journald (man-sida): https://www.freedesktop.org/software/systemd/man/latest/systemd-journald.service.html

rsyslog ‚Äì dokumentation: https://www.rsyslog.com/doc/

IETF ‚Äì Syslog Protocol (RFC 5424): https://www.rfc-editor.org/rfc/rfc5424

SNMPv3 ‚Äì √∂versikt (Cisco): https://www.cisco.com/c/en/us/tech/snmp/

Wazuh ‚Äì dokumentation: https://documentation.wazuh.com/

Elastic Security (SIEM-koncept, √∂versikt): https://www.elastic.co/security/siem

Microsoft Sentinel (SIEM/SOAR-koncept, √∂versikt): https://learn.microsoft.com/azure/sentinel/overview

FIRST ‚Äì Common Event Expression & Logging best practices: https://www.first.org/cvss/user-guide & https://www.first.org/resources/papers/logging

NIST ‚Äì Guide to Computer Security Log Management (SP 800-92): https://csrc.nist.gov/publications/detail/sp/800-92/final

### 

### ‚úçÔ∏è Egna anteckningar

‚Ä¶


