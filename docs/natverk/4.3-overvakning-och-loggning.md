# 4. Säkerhet och övervakning

## 4.3 Övervakning och loggning

### 4.3.1 Varför loggar och övervakar man?

Övervakning och loggning handlar om synlighet: att kunna svara på vad hände, när, var, och av vem – och att upptäcka när något avviker innan det blir ett driftstopp eller en incident. Loggar är dessutom bevismaterial när något måste utredas i efterhand. Två praktiska förutsättningar bär hela området: tidssynk (utan gemensam klocka går det inte att korrelera händelser) och centralisering (att samla loggar på en plats där de kan sökas, korreleras och larma).

I ett modernt nät är loggkällorna många: klienter och servrar, nätverksutrustning (switchar, routrar, brandväggar, WLAN-kontroller), katalogtjänster (AD/LDAP), DNS/DHCP, applikationer och identitetstjänster. Poängen är inte att “logga allt”, utan att logga rätt saker med lagom detaljer – och ha en tydlig ägare som faktiskt tittar på signalerna.

Förtydligande (sammanfattning):

- Synlighet: loggar = svar på “vad, när, var, vem”.
- Grundkrav: tidssynk och centralisering.
- Urval: logga det som behövs för att se avvikelser och felsöka – inte allt.

Synlighet: loggar = svar på “vad, när, var, vem”.

Grundkrav: tidssynk och centralisering.

Urval: logga det som behövs för att se avvikelser och felsöka – inte allt.

Exempel: En kort driftstörning i inloggning spåras på minuter tack vare gemensamma tidsstämplar: DNS-logg visar misslyckat uppslag, brandväggslogg visar blockerat flöde mot extern resolver, AD-logg visar ökade autentiseringsfel – kedjan blir tydlig och åtgärdas.

### 4.3.2 Logghantering: Event Viewer (Windows), syslog (Unix/Linux/nät)

Windows loggar till Event Viewer (Händelsevisaren) i kanaler som System, Application, Security och applikationsspecifika loggar. Händelser har nivåer (Information/Warning/Error/Critical), källor och ofta händelse-ID som gör dem sökbara. Säkerhetsloggar (t.ex. inloggning, gruppändringar, policy) blir väldigt användbara när de korreleras med nät- och applikationsloggar.

Unix/Linux och nätutrustning använder oftast syslog – ett standardprotokoll och ett format för loggar. Syslog har facility (vilken del av systemet) och severity (emerg, alert, crit, err, warning, notice, info, debug). På Linux skrivs loggar numera ofta till systemd-journald (den binära journalen), och skickas därifrån vidare till en syslog-tjänst (t.ex. rsyslog/syslog-ng) för central insamling. Nätutrustning skickar syslog direkt till en central loggserver. UDP/514 är klassiskt, men TCP/TLS bör användas när det är möjligt för att undvika tapp och skydda innehåll.

För att loggar ska vara användbara behövs också: namnstandarder (värdnamn som går att tolka), loggrotation och retention (hur länge sparas vad), åtkomstkontroll (vem får läsa), samt normalisering (göra olika källor jämförbara) i den centrala plattformen.

Förtydligande (sammanfattning):

- Windows: Event Viewer med kanaler, nivåer, event-ID.
- Unix/Linux & nät: syslog (facility/severity) + ofta journald på Linux.
- Praktik: TLS/TCP när det går, tydliga namn, genomtänkt retention och rättigheter.

Windows: Event Viewer med kanaler, nivåer, event-ID.

Unix/Linux & nät: syslog (facility/severity) + ofta journald på Linux.

Praktik: TLS/TCP när det går, tydliga namn, genomtänkt retention och rättigheter.

Exempel: En switchport “flappar” (går upp/ner). Syslog från switchen visar portens statusändringar, Event Viewer på filservern visar samtidigt tappade nätverksresurser. Tidslinjen kopplar ihop händelserna och gör felet lätt att lokalisera.

### 4.3.3 Verktyg: Wazuh, SNMP, SIEM

Wazuh är en öppen plattform för säkerhetsövervakning som kombinerar logginsamling med funktioner som FIM (File Integrity Monitoring), sårbarhets-indikering och regelbaserade larm. Den använder agenter (på klient/servrar) men kan också ta emot loggar via syslog. Vanligt är att lagra/söka i en Elastic/OpenSearch-stack med färdiga instrumentpaneler. Poängen är att få sammanhang: “denna fil ändrades, på denna värd, direkt efter denna inloggning”.

SNMP (Simple Network Management Protocol) är nätutrustningens telemetri. Med GET kan man läsa mätvärden (interfacestatistik, CPU, temperatur), med TRAP/INFORM skickar enheten händelser proaktivt (länk ner/upp, fläktfel, överhettning). MIB/OID beskriver vad som kan läsas. Version SNMPv3 ger autentisering och kryptering (till skillnad från v1/v2c som använder community-strängar). I övervakning utgör SNMP “hälsopulsen” som kompletterar loggar.

SIEM (Security Information and Event Management) är den centrala plattformen som samlar, normaliserar, korrelerar och larmar på tvärs av källor: serverloggar, nätflöden, AD-händelser, brandvägg, DNS, proxy. Exempel på funktioner: korrelationsregler (“många misslyckade inloggningar + lyckad från ovanlig klient”), dashboard med indikatorer, larmhantering och playbooks för åtgärd. SIEM är inte lika med “dyra licenser” – principen kan uppnås med både öppna och kommersiella byggstenar – men tidsstämplar, normalisering och ägarskap är alltid avgörande.

Förtydligande (sammanfattning):

- Wazuh: agent + regler + dashboards; binder ihop fil/host/nät-händelser.
- SNMP: mätvärden och traps från nät- och infrastruktur; SNMPv3 för säkerhet.
- SIEM: central hjärna för insamling, korrelation och larm.

Wazuh: agent + regler + dashboards; binder ihop fil/host/nät-händelser.

SNMP: mätvärden och traps från nät- och infrastruktur; SNMPv3 för säkerhet.

SIEM: central hjärna för insamling, korrelation och larm.

Exempel: SNMP visar ökande felräknare på ett switchinterface; Wazuh larmar samtidigt om ovanligt många TCP-återförsök på en server i samma VLAN. SIEM visar korrelationen på en tidslinje – felet ligger på länken mellan dem, inte i applikationen.

### 4.3.4 Att tolka loggar och upptäcka avvikelser

Loggar blir meningsfulla när de sätts i sammanhang. Ett fungerande arbetssätt börjar med en fråga (“varför är inloggning långsam?”, “vem skapade denna delning?”), väljer källor (AD/brandvägg/klient), och binder ihop händelser via tidsstämplar och identiteter (användare, värd, IP, process). Två vägar används parallellt:

- Regel- och tröskelbaserat: “>10 misslyckade inloggningar (Windows Event ID) från samma IP på 5 min” → bruteforce-indikator; “ny medlem i lokal admins” → larma.
- Avvikelsebaserat: “denna klient gör plötsligt tusentals DNS-frågor mot externa domäner” eller “den här servern pratar ut på en port den aldrig använt”.

Regel- och tröskelbaserat: “>10 misslyckade inloggningar (Windows Event ID) från samma IP på 5 min” → bruteforce-indikator; “ny medlem i lokal admins” → larma.

Avvikelsebaserat: “denna klient gör plötsligt tusentals DNS-frågor mot externa domäner” eller “den här servern pratar ut på en port den aldrig använt”.

Båda kräver baslinjer: hur “ser normalt ut”? Utan baslinje blir allt antingen larm eller brus. Därför finjusteras regler (trösklar, suppressionsfönster, deduplicering) tills larmen är få men viktiga. Och varje “rött larm” behöver en runbook: vem äger det, vilka steg tas, när eskaleras?

Förtydligande (sammanfattning):

- Frågedriven metod: fråga → källor → korrelation → slutsats.
- Två blickar: regler/trösklar och avvikelse/baslinje.
- Tuning: trösklar, dedup, suppression; runbooks för åtgärd.

Frågedriven metod: fråga → källor → korrelation → slutsats.

Två blickar: regler/trösklar och avvikelse/baslinje.

Tuning: trösklar, dedup, suppression; runbooks för åtgärd.

Exempel: SIEM larmar: “Många misslyckade inloggningar följt av en lyckad (samma konto), därefter ny RDP-session från ovanlig klient”. Korrelation med AD-logg visar att kontot lades till i en lokal admin-grupp — en tydlig kedja som stoppas genom att spärra kontot och rulla lösenord/nycklar.

### 4.3.5 Larm, brus och ansvar (vem gör vad när det blinkar?)

Ett övervakningssystem utan ägare blir snabbt en “blinkande tavla”. Definiera allvarsnivåer, SLA för hantering (t.ex. kritiskt = 15 minuter till åtgärd), och vägar för eskalering. Arbeta bort falskpositiv genom att justera regler, lägga undantag för kända mönster och tidsbegränsa undertryckning. Testa larmkedjan med table-top-övningar och simulera verkliga händelser (t.ex. många misslyckade logins) för att se att kedjan håller.

Förtydligande (sammanfattning):

- Sätt nivåer och tider: så vet alla vad som förväntas.
- Minska brus: justera, vitlista kända mönster, följ upp.
- Öva: simuleringar visar var kedjan brister.

Sätt nivåer och tider: så vet alla vad som förväntas.

Minska brus: justera, vitlista kända mönster, följ upp.

Öva: simuleringar visar var kedjan brister.

Exempel: Ett “stormlarm” om misslyckade inloggningar visar sig bero på lösenordsbyte i en klass. En suppression-regel införs (1 h för just den källan), men ett separat larm ligger kvar för inloggningar från internet – så att verkliga försök inte tystas.

### 4.3.6 Dataskydd och etik

Loggar kan innehålla personuppgifter (användarnamn, IP, tid, ibland filnamn). Det gör dataminimering, behörighetsstyrning, retention och syftesbeskrivning viktiga. Loggar ska skyddas lika omsorgsfullt som andra system och bara vara tillgängliga för dem som behöver dem i sitt arbete.

Förtydligande (sammanfattning):

- Minimera: samla det som behövs – inte mer.
- Skydda: åtkomstkontroll, kryptering, revision.
- Rensa: retention kopplad till syfte och lagkrav.

Minimera: samla det som behövs – inte mer.

Skydda: åtkomstkontroll, kryptering, revision.

Rensa: retention kopplad till syfte och lagkrav.

Exempel: Säkerhetsloggar sparas 12 månader för incidentutredning och revisionskrav; applikationsloggar med personnära data rensas efter 30 dagar. Åtkomst till SIEM är gruppstyrd och loggas.

### 📌 Kontrollfrågor

- Varför är tidssynk och centralisering grundläggande för användbara loggar?
- Vilka är de viktigaste skillnaderna mellan Event Viewer och syslog?
- Vad gör SNMP (Simple Network Management Protocol) i övervakning, och varför föredras SNMPv3?
- Beskriv hur Wazuh kan ge sammanhang mellan loggar, filändringar och inloggningar.
- Vad betyder SIEM (Security Information and Event Management) i praktiken – vilka tre saker gör ett SIEM alltid?
- Ge exempel på en regelbaserad respektive en avvikelsebaserad detektion.
- Varför behövs baslinjer och hur påverkar de antalet falsklarm?
- Vad är en runbook, och varför är den central när ett larm går?
- Nämn tre beslut man måste ta kring retention och åtkomst till loggar.
- Vad bör loggas för att kunna utreda “plötsligt långsam inloggning” utan att samla onödigt innehåll?

Varför är tidssynk och centralisering grundläggande för användbara loggar?

Vilka är de viktigaste skillnaderna mellan Event Viewer och syslog?

Vad gör SNMP (Simple Network Management Protocol) i övervakning, och varför föredras SNMPv3?

Beskriv hur Wazuh kan ge sammanhang mellan loggar, filändringar och inloggningar.

Vad betyder SIEM (Security Information and Event Management) i praktiken – vilka tre saker gör ett SIEM alltid?

Ge exempel på en regelbaserad respektive en avvikelsebaserad detektion.

Varför behövs baslinjer och hur påverkar de antalet falsklarm?

Vad är en runbook, och varför är den central när ett larm går?

Nämn tre beslut man måste ta kring retention och åtkomst till loggar.

Vad bör loggas för att kunna utreda “plötsligt långsam inloggning” utan att samla onödigt innehåll?

### 

### 🔗 Fördjupningslänkar

- Microsoft – Event Viewer (översikt): https://learn.microsoft.com/windows/client-management/troubleshoot-event-viewer
- systemd-journald (man-sida): https://www.freedesktop.org/software/systemd/man/latest/systemd-journald.service.html
- rsyslog – dokumentation: https://www.rsyslog.com/doc/
- IETF – Syslog Protocol (RFC 5424): https://www.rfc-editor.org/rfc/rfc5424
- SNMPv3 – översikt (Cisco): https://www.cisco.com/c/en/us/tech/snmp/
- Wazuh – dokumentation: https://documentation.wazuh.com/
- Elastic Security (SIEM-koncept, översikt): https://www.elastic.co/security/siem
- Microsoft Sentinel (SIEM/SOAR-koncept, översikt): https://learn.microsoft.com/azure/sentinel/overview
- FIRST – Common Event Expression & Logging best practices: https://www.first.org/cvss/user-guide & https://www.first.org/resources/papers/logging
- NIST – Guide to Computer Security Log Management (SP 800-92): https://csrc.nist.gov/publications/detail/sp/800-92/final

Microsoft – Event Viewer (översikt): https://learn.microsoft.com/windows/client-management/troubleshoot-event-viewer

systemd-journald (man-sida): https://www.freedesktop.org/software/systemd/man/latest/systemd-journald.service.html

rsyslog – dokumentation: https://www.rsyslog.com/doc/

IETF – Syslog Protocol (RFC 5424): https://www.rfc-editor.org/rfc/rfc5424

SNMPv3 – översikt (Cisco): https://www.cisco.com/c/en/us/tech/snmp/

Wazuh – dokumentation: https://documentation.wazuh.com/

Elastic Security (SIEM-koncept, översikt): https://www.elastic.co/security/siem

Microsoft Sentinel (SIEM/SOAR-koncept, översikt): https://learn.microsoft.com/azure/sentinel/overview

FIRST – Common Event Expression & Logging best practices: https://www.first.org/cvss/user-guide & https://www.first.org/resources/papers/logging

NIST – Guide to Computer Security Log Management (SP 800-92): https://csrc.nist.gov/publications/detail/sp/800-92/final

### 

### ✍️ Egna anteckningar

…


