# Kapitel 1 ‚Äì Vad √§r ett n√§tverk?

## 1.3 Protokoll och adressering

### 1.3.1 Varf√∂r protokoll?

Protokoll √§r regler som g√∂r att olika system kan f√∂rst√• varandra. De definierar hur data ska paketeras, adresseras, √∂verf√∂ras och kontrolleras f√∂r fel. I praktiken arbetar flera protokoll tillsammans i en protokollstack (t.ex. TCP/IP), d√§r varje lager har sin uppgift: fr√•n fysisk √∂verf√∂ring till applikationer som webbl√§sare och e-post.

Ett vanligt fels√∂kningsgrepp √§r att ‚Äúg√• ner√•t i stacken‚Äù tills du hittar l√§gsta lagret d√§r felet uppst√•r.

Exempel: En webbplats laddar inte. Du kontrollerar f√∂rst om applikationen (HTTP) svarar, sedan om transport (TCP/443) etablerar f√∂rbindelse, d√§refter om Internetlagret (IP) ruttnar r√§tt, och slutligen om n√§tverks√•tkomst (Ethernet/WLAN) har l√§nk.

### 1.3.2 TCP och UDP (transportlagret)

TCP (Transmission Control Protocol) √§r f√∂rbindelseorienterat: trev√§gshandskakning (SYN‚ÄìSYN/ACK‚ÄìACK), kvittenser och oms√§ndning vid paketf√∂rlust. Det passar d√§r tillf√∂rlitlighet √§r viktigt: webben (HTTP/HTTPS), e-post (SMTP/IMAP), fil√∂verf√∂ring (SFTP/FTPS).

UDP (User Datagram Protocol) √§r f√∂rbindelsel√∂st: inget handskak, inga kvittenser. F√∂rdel: l√•g latens och mindre overhead. Vanligt f√∂r realtidsapplikationer som VoIP, vissa spel och DNS-fr√•gor.

Portnummer identifierar vilken tj√§nst som ska ta emot datan. ‚ÄúV√§lk√§nda portar‚Äù (0‚Äì1023) anv√§nds av standardtj√§nster, ‚Äúregistrerade‚Äù (1024‚Äì49151) av applikationer, och ‚Äúdynamiska/privata‚Äù (49152‚Äì65535) v√§ljs oftast som k√§llport av klienter.

Exempel: Din klient √∂ppnar en HTTPS-anslutning fr√•n k√§llport 51234 till serverns port 443. Svaret g√•r tillbaka till 51234.

### 1.3.3 Vanliga infrastrukturprotokoll

Korsh√§nvisning: se avsnitt 2.4 DHCP, DNS och NAT f√∂r detaljer och fels√∂kning.

- ARP (Address Resolution Protocol) ‚Äì √∂vers√§tter IP ‚Üí MAC inom LAN. N√∂dv√§ndigt f√∂r att skicka Ethernet-ramar till r√§tt n√§tverkskort.
- ICMP (Internet Control Message Protocol) ‚Äì skickar kontrollmeddelanden (t.ex. ping). Bra f√∂r diagnos, inte f√∂r applikationsdata.
- DHCP (Dynamic Host Configuration Protocol) ‚Äì tilldelar automatiskt IP-adress, n√§tmask, gateway och DNS till klienter.
- DNS (Domain Name System) ‚Äì √∂vers√§tter namn ‚Üí IP (t.ex. example.se ‚Üí 93.184.216.34). Kritisk f√∂r n√§stan all applikationstrafik.
- NTP (Network Time Protocol) ‚Äì synkroniserar tid mellan system; viktigt f√∂r loggar, Kerberos och certifikat.

ARP (Address Resolution Protocol) ‚Äì √∂vers√§tter IP ‚Üí MAC inom LAN. N√∂dv√§ndigt f√∂r att skicka Ethernet-ramar till r√§tt n√§tverkskort.

ICMP (Internet Control Message Protocol) ‚Äì skickar kontrollmeddelanden (t.ex. ping). Bra f√∂r diagnos, inte f√∂r applikationsdata.

DHCP (Dynamic Host Configuration Protocol) ‚Äì tilldelar automatiskt IP-adress, n√§tmask, gateway och DNS till klienter.

DNS (Domain Name System) ‚Äì √∂vers√§tter namn ‚Üí IP (t.ex. example.se ‚Üí 93.184.216.34). Kritisk f√∂r n√§stan all applikationstrafik.

NTP (Network Time Protocol) ‚Äì synkroniserar tid mellan system; viktigt f√∂r loggar, Kerberos och certifikat.

Blockeras DNS eller DHCP i fel segment f√•r klienter snabbt ‚Äúmystiska‚Äù problem (ingen adress, eller kan inte n√• resurser trots n√§tverksl√§nk).

### 1.3.4 IPv4-adressering: struktur och begrepp

IPv4 best√•r av 32 bitar, skrivs i punktnotation (t.ex. 192.168.10.15). Subn√§tmasken avg√∂r hur m√•nga bitar som beskriver n√§tet (prefix), t.ex. /24 motsvarar 255.255.255.0. Resten √§r v√§rdbitar.

Gateway (default gateway) √§r den routeradress inom ditt subn√§t som tar trafik ut till andra n√§t.

Viktiga adresser och omr√•den:

- Privata n√§t (RFC1918): 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
- APIPA/Link-local: 169.254.0.0/16 (klienter ger sig sj√§lva om DHCP saknas)
- Loopback: 127.0.0.0/8 (t.ex. 127.0.0.1)
- Broadcast: sista adressen i subn√§tet (t.ex. 192.168.10.255 i /24)

Privata n√§t (RFC1918): 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16

APIPA/Link-local: 169.254.0.0/16 (klienter ger sig sj√§lva om DHCP saknas)

Loopback: 127.0.0.0/8 (t.ex. 127.0.0.1)

Broadcast: sista adressen i subn√§tet (t.ex. 192.168.10.255 i /24)

Exempel: I subn√§tet 192.168.10.0/24 kan du ofta v√§lja 192.168.10.1 som gateway, anv√§nda 192.168.10.10‚Äì.200 f√∂r klienter, och reservera 192.168.10.210‚Äì.220 f√∂r servrar och n√§tverksskrivare.

### 1.3.5 Subn√§t och CIDR

CIDR (Classless Inter-Domain Routing) anv√§nder prefixl√§ngd (t.ex. /24) i st√§llet f√∂r ‚Äúklass A/B/C‚Äù. Att subn√§ta betyder att l√•na v√§rdbitar till n√§tbitar f√∂r att skapa fler, mindre n√§t.

En /24 har 256 adresser (0‚Äì255), en /25 har 128, en /26 har 64, osv. Antal anv√§ndbara v√§rdadresser blir alltid totalen minus n√§t- och broadcastadresser.

Exempel: 192.168.10.0/24 kan delas i tv√• /25: 192.168.10.0‚Äì127 (/25) och 192.168.10.128‚Äì255 (/25). Varje /25 ger 126 anv√§ndbara v√§rdar.

### 1.3.6 NAT och PAT (IPv4)

NAT (Network Address Translation) √∂vers√§tter privata adresser till publika. PAT (Port Address Translation) l√•ter m√•nga interna klienter dela en publik adress genom att s√§rskilja dem via portar (kallas ofta ‚ÄúNAT overload‚Äù).

Port forwarding (DNAT) √∂ppnar en publik port och vidarebefordrar den till en specifik intern adress/tj√§nst (t.ex. publik:443 ‚Üí 192.168.10.20:443).

Exempel: Din OPNsense har publik IP 203.0.113.10. Du vidarebefordrar TCP 443 till 192.168.10.20 f√∂r en webbserver i DMZ.

### 1.3.7 IPv6: grunder och skillnader

IPv6 har 128 bitar och skrivs i hex (t.ex. 2001:db8:abcd:12::15). Regler f√∂r f√∂rkortning:

- Ledande nollor i varje f√§lt kan tas bort.
- En sekvens av nollf√§lt kan ers√§ttas en g√•ng med ::.

Ledande nollor i varje f√§lt kan tas bort.

En sekvens av nollf√§lt kan ers√§ttas en g√•ng med ::.

Adress-typer:

- Global Unicast (2000::/3) ‚Äì motsvarar publika adresser.
- Unique Local (ULA) (fc00::/7, vanligt: fdxx::/8) ‚Äì f√∂r interna n√§t.
- Link-local (fe80::/64) ‚Äì finns alltid p√• ett gr√§nssnitt; anv√§nds f√∂r grannuppt√§ckt.
- Multicast (ff00::/8) ‚Äì ers√§tter broadcast-konceptet.

Global Unicast (2000::/3) ‚Äì motsvarar publika adresser.

Unique Local (ULA) (fc00::/7, vanligt: fdxx::/8) ‚Äì f√∂r interna n√§t.

Link-local (fe80::/64) ‚Äì finns alltid p√• ett gr√§nssnitt; anv√§nds f√∂r grannuppt√§ckt.

Multicast (ff00::/8) ‚Äì ers√§tter broadcast-konceptet.

Centrala protokoll/koncept:

- ICMPv6 (obligatoriskt): eco-request/-reply, fel, och ND (Neighbor Discovery)‚Äîers√§tter ARP.
- SLAAC (stateless autoconf) och DHCPv6 f√∂r adress√§ttning.
- NAT beh√∂vs normalt inte (och undviks); segmentering och brandv√§ggsregler st√•r f√∂r s√§kerhet.

ICMPv6 (obligatoriskt): eco-request/-reply, fel, och ND (Neighbor Discovery)‚Äîers√§tter ARP.

SLAAC (stateless autoconf) och DHCPv6 f√∂r adress√§ttning.

NAT beh√∂vs normalt inte (och undviks); segmentering och brandv√§ggsregler st√•r f√∂r s√§kerhet.

Exempel: Ett subn√§t kan vara 2001:db8:100:10::/64. En server kan ha 2001:db8:100:10::20, gateway 2001:db8:100:10::1.

Dual-stack betyder att k√∂ra IPv4 och IPv6 parallellt; vanligt i √∂verg√•ngsperioder.

### 1.3.8 Gateways och grundl√§ggande routing

Default gateway kr√§vs f√∂r att n√• andra n√§t. Finns ingen v√§g (route) till ett n√§t, kommer trafiken att skickas mot defaulten. P√• routrar kan du skapa statiska rutter (manuellt) eller anv√§nda dynamiska protokoll (t.ex. RIP, OSPF) som l√§r sig v√§gar automatiskt.

I sm√• milj√∂er r√§cker ofta statisk routing; i st√∂rre n√§t blir dynamisk routing en n√∂dv√§ndighet f√∂r skalbarhet och redundans.

### 1.3.9 Vanliga portar och tj√§nster

- 20/21 FTP (fil√∂verf√∂ring ‚Äì legacy, ers√§tt ofta med SFTP/FTPS)
- 22 SSH (s√§ker fj√§rranslutning)
- 23 Telnet (os√§kert, l√§mnas av historiska sk√§l)
- 25/587/465 SMTP (e-post ut)
- 53 DNS (UDP/TCP)
- 67/68 DHCP (server/klient)
- 80 HTTP (webb)
- 123 NTP (tid)
- 139/445 SMB (fildelning i Windows)
- 389/636 LDAP/LDAPS (katalogtj√§nster)
- 443 HTTPS (s√§ker webb)
- 3389 RDP (fj√§rrskrivbord)

20/21 FTP (fil√∂verf√∂ring ‚Äì legacy, ers√§tt ofta med SFTP/FTPS)

22 SSH (s√§ker fj√§rranslutning)

23 Telnet (os√§kert, l√§mnas av historiska sk√§l)

25/587/465 SMTP (e-post ut)

53 DNS (UDP/TCP)

67/68 DHCP (server/klient)

80 HTTP (webb)

123 NTP (tid)

139/445 SMB (fildelning i Windows)

389/636 LDAP/LDAPS (katalogtj√§nster)

443 HTTPS (s√§ker webb)

3389 RDP (fj√§rrskrivbord)

I brandv√§ggsdesign √∂ppnas bara n√∂dv√§ndiga portar inifr√•n ‚Üí ut och utifr√•n ‚Üí in; allt annat blockeras som standard.

### 

### üìå Kontrollfr√•gor

- Varf√∂r √§r protokoll uppdelade i lager i en stack?
- N√§mn tv√• skillnader mellan TCP och UDP.
- Vilken funktion har ARP i ett LAN?
- Vad g√∂r DNS och varf√∂r √§r det kritiskt f√∂r anv√§ndare?
- F√∂rklara relationen mellan IP-adress, subn√§tmask/prefix och gateway.
- Vilka √§r de tre privata IPv4-omr√•dena enligt RFC1918?
- Vad √§r f√∂rdelarna med PAT j√§mf√∂rt med ‚Äúren‚Äù NAT?
- Ange tre centrala skillnader mellan IPv4 och IPv6.
- Vad √§r en default gateway och n√§r anv√§nds den?
- Ge tre exempel p√• vanliga portar och tillh√∂rande tj√§nster.

Varf√∂r √§r protokoll uppdelade i lager i en stack?

N√§mn tv√• skillnader mellan TCP och UDP.

Vilken funktion har ARP i ett LAN?

Vad g√∂r DNS och varf√∂r √§r det kritiskt f√∂r anv√§ndare?

F√∂rklara relationen mellan IP-adress, subn√§tmask/prefix och gateway.

Vilka √§r de tre privata IPv4-omr√•dena enligt RFC1918?

Vad √§r f√∂rdelarna med PAT j√§mf√∂rt med ‚Äúren‚Äù NAT?

Ange tre centrala skillnader mellan IPv4 och IPv6.

Vad √§r en default gateway och n√§r anv√§nds den?

Ge tre exempel p√• vanliga portar och tillh√∂rande tj√§nster.

### 

### üîó F√∂rdjupningsl√§nkar

- https://www.cloudflare.com/learning/network-layer/what-is-arp/
- https://www.ripe.net/about-us/press-centre/understanding-ipv6/
- https://www.cisco.com/c/en/us/solutions/enterprise-networks/ipv6/index.html
- https://www.rfc-editor.org/rfc/rfc1918
- https://www.rfc-editor.org/rfc/rfc8200

https://www.cloudflare.com/learning/network-layer/what-is-arp/

https://www.ripe.net/about-us/press-centre/understanding-ipv6/

https://www.cisco.com/c/en/us/solutions/enterprise-networks/ipv6/index.html

https://www.rfc-editor.org/rfc/rfc1918

https://www.rfc-editor.org/rfc/rfc8200

### 

### ‚úçÔ∏è Egna anteckningar



