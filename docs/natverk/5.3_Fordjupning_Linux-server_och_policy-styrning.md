---
title: "5.3 F√∂rdjupning: Linux-server och policy-styrning"
parent: "N√§tverk"
nav_order: 503
---

# 5.3 F√∂rdjupning: Linux-server och policy-styrning

### 5.3.1 Varf√∂r Linux p√• server?
Om man vill bygga stabila, resurssn√•la och flexibla serversystem √§r Linux ofta ett naturligt val. Man f√•r stor kontroll √∂ver vilka tj√§nster som k√∂rs, kan automatisera n√§stan allt och skala fr√•n en liten VM till ett helt kluster. Licensmodellen (√∂ppen k√§llkod eller abonnemang) g√∂r ocks√• att ekonomi och support kan anpassas efter verksamheten. Tanken √§r att beskriva hur systemet ska se ut och uppf√∂ra sig, och sedan l√•ta verktygen upprepa det ‚Äî varje g√•ng, p√• varje server.
Exempel: En gemensam ‚Äúbas‚Äù med samma SSH-policy, brandv√§gg och loggning anv√§nds f√∂r flera servrar. Varje maskin f√•r sedan sin roll (webb, fil, proxy), men grundbeteendet √§r likadant och enkelt att √•terskapa.
### 5.3.2 Grunden: distribution, paket, konton och baspolicy
Om man √§r ny och ovan vid att s√§tta upp Linuxservrar √§r det l√§mpligt att v√§lja en LTS-distribution (t.ex. Ubuntu Server LTS eller Debian Stable; Rocky/Alma om man vill ha RHEL-kompatibilitet). LTS brukar inneb√§ra l√§ngre s√§kerhetsst√∂d och lugnare f√∂r√§ndringstakt. Paket hanteras typiskt via APT (Debian/Ubuntu) eller DNF (RHEL-familjen); m√•nga upplever att det blir tryggast att i f√∂rsta hand h√•lla sig till distributionens egna arkiv.
N√§r det g√§ller konton och r√§ttigheter b√∂rjar m√•nga med vanliga anv√§ndarkonton och l√•ter administrat√∂rsr√§tt g√• via sudo. Det kan k√§nnas tryggt att logga f√∂rh√∂jda kommandon, s√• att man i efterhand kan se vad som k√∂rts och av vem. √Ötkomsten sker ofta via SSH; d√• v√§ljer m√•nga att anv√§nda nycklar i st√§llet f√∂r l√∂senord och, d√§r riskbilden motiverar det, komplettera med tv√•faktor via PAM.
Baspolicy i praktiken: tidsynk (chrony eller systemd-timesyncd), en enkel brandv√§gg (ufw eller firewalld), ett MAC-skydd (AppArmor eller SELinux), central loggning (rsyslog) och f√∂ruts√§gbar loggrotation. Det √§r inte komplicerat ‚Äî men g√∂r stor skillnad √∂ver tid.
Exempel: En nysatt server f√•r ett administrat√∂rskonto med sudo, SSH-nyckelinloggning, brandv√§gg som bara √∂ppnar 22/80/443, tidsynk mot intern NTP, och loggar som skickas till en central loggtj√§nst.
### 5.3.3 N√§tverk p√• Linux: IP, VLAN, bond och brygga
N√§r du ska konfigurera n√§tverket i en Linuxserver √§r det viktigt att man h√•ller sig till ett konfigurationss√§tt (netplan/systemd-networkd, NetworkManager eller distributionsspecifika filer) och inte blandar. Det underl√§ttar fels√∂kning och minskar risken f√∂r konflikter d√§r flera komponenter f√∂rs√∂ker g√∂ra samma sak. I serverdrift handlar n√§tet ofta om n√•gra √•terkommande byggstenar: statisk IP med gateway/DNS, VLAN f√∂r segmentering, bonding/LACP f√∂r redundans/kapacitet, och ibland en bridge om v√§rden ska husera KVM-VM:er eller containrar.
Exempel: En webb-VM i DMZ (VLAN 70) pratar bara med reverse-proxyn. Backuptrafik g√•r p√• ett andra interface i VLAN 99 till backupservern ‚Äî skilt fr√•n produktionstrafiken.
S√• h√§r kan en minimal netplan-definition se ut (statisk IP + VLAN):
# /etc/netplan/01-server.yaml
network:
version: 2
ethernets:
eno1:
dhcp4: no
vlans:
vlan40:
id: 40
link: eno1
addresses: [192.0.2.10/24]
gateway4: 192.0.2.1
nameservers:
addresses: [192.0.2.53, 192.0.2.54]
### 5.3.4 Vanliga tj√§nster: SSH/SFTP, SMB/NFS, webb och certifikat
I m√•nga milj√∂er b√∂rjar man med SSH/SFTP f√∂r administration och fil√∂verf√∂ring. Det √§r vanligt att st√§nga av l√∂senordsinloggning, styra vilka anv√§ndare eller grupper som f√•r logga in och l√•ta √•tkomst g√• via en bastionv√§rd i st√§llet f√∂r direkt fr√•n internet. F√∂r filresurser v√§ljer m√•nga Samba/SMB n√§r Windows-klienter ska ansluta och NFSv4 n√§r det √§r Linux-till-Linux ‚Äî b√•da kan anv√§nda POSIX-ACL f√∂r finmaskiga r√§ttigheter. F√∂r webb √§r Nginx ett vanligt val, ofta som reverse proxy framf√∂r applikationer, med automatiserad hantering av TLS-certifikat (t.ex. via ACME/certbot) s√• att f√∂rnyelser sk√∂ts utan handp√•l√§ggning.
Exempel: En publik webbapp k√∂r bakom Nginx. Endast 80/443 √§r √∂ppna i brandv√§ggen. SSH √§r √•tkomligt enbart fr√•n bastion, inte fr√•n internet i stort.
### 5.3.5 Central identitet och ‚Äúpolicy‚Äù: AD/SSSD, FreeIPA och polkit
Om man vill slippa separata lokala konton p√• varje server g√•r det fint att koppla Linux till central identitet. Med realmd/SSSD kan system autentisera mot AD och tilldela sudo-r√§ttigheter till vissa grupper. I Linuxv√§rlden finns ocks√• FreeIPA, som kombinerar LDAP, Kerberos, certifikat och host-baserad √•tkomstkontroll. Lokalt p√• varje maskin handlar det ofta om sudoers och polkit (vad en anv√§ndare f√•r g√∂ra n√§r en tj√§nst ber om h√∂jda privilegier), samt PAM f√∂r hur inloggningar ska g√• till.
Exempel: Gruppen ‚Äúops-admin‚Äù i AD f√•r sudo p√• alla Linux-servrar (styrt via SSSD och en enkel fil i /etc/sudoers.d/). Gruppen ‚Äúops-ro‚Äù f√•r bara l√§sa journalen och k√∂ra ett f√•tal diagnostikkommandon.
### 5.3.6 ‚ÄúPolicy som kod‚Äù: Ansible som Linux-motsvarighet till GPO
N√§r man vill att servrar ska se likadana ut √∂ver tid, oavsett vem som satt dem, brukar Ansible vara ett l√§ttillg√§ngligt verktyg. Id√©n √§r att beskriva √∂nskat tillst√•nd i YAML; k√∂rningen √§r idempotent, s√• bara det som faktiskt beh√∂ver √§ndras √§ndras. M√•nga b√∂rjar med att standardisera paket, tj√§nster, sshd-inst√§llningar, brandv√§gg, anv√§ndare och filr√§ttigheter ‚Äî och l√§gger allt i ett versionshanterat repo.
S√• h√§r kan en liten bas-playbook se ut (illustration):
- hosts: linuxservrar
become: true
tasks:
- name: Installera baspaket
package:
name: [vim, curl, htop, fail2ban]
state: present
- name: H√•rda sshd (st√§ng l√∂senord)
lineinfile:
path: /etc/ssh/sshd_config
regexp: '^PasswordAuthentication'
line: 'PasswordAuthentication no'
notify: restart ssh
- name: Enkelt brandv√§ggsl√§ge
ufw:
state: enabled
rule: allow
port: "{{ item }}"
loop: [22, 80, 443]
handlers:
- name: restart ssh
service:
name: ssh
state: restarted
Exempel: En nattlig k√∂rning applicerar ‚ÄúBas-Linux‚Äù p√• alla servrar. Om n√•gon r√•kat √§ndra en konfigfil f√∂r hand, √•terst√§lls den till √∂verenskommet l√§ge.
### 5.3.7 Programvarudistribution och uppdateringar p√• Linux
F√∂r sj√§lva programvaran upplever m√•nga att det blir smidigast att l√•ta distributionens pakethanterare (APT eller DNF) g√∂ra jobbet. Det kan vara hj√§lpsamt att t√§nka i ringar √§ven h√§r: en liten pilotgrupp f√∂rst, d√§refter bredare utrullning, och sist de mest k√§nsliga systemen. S√§kerhetsuppdateringar tenderar att rullas snabbare, medan funktionsuppdateringar ofta f√•r passera en testperiod. P√• Debian/Ubuntu kan unattended-upgrades sk√∂ta s√§kerhetsfixar automatiskt; p√• RHEL-familjen finns dnf-automatic. K√§rnuppdateringar kan kr√§va omstart, s√• planerade f√∂nster g√∂r livet enklare ‚Äî i vissa milj√∂er anv√§nder man livepatch f√∂r att minska antalet omstarter.
S√• h√§r kan ett f√∂rsta steg mot automatiska s√§kerhetsfixar se ut (illustration):
# Debian/Ubuntu
sudo apt install unattended-upgrades
sudo dpkg-reconfigure unattended-upgrades
# RHEL/Rocky/Alma
sudo dnf install dnf-automatic
sudo systemctl enable --now dnf-automatic.timer
Exempel: Tre inventariegrupper (pilot ‚Üí bred ‚Üí sen). S√§kerhetsfixar g√•r direkt till alla; st√∂rre f√∂r√§ndringar provar man en vecka i pilot innan de sl√§pps vidare.
### 5.3.8 Lokala paketf√∂rr√•d (repos) ‚Äì f√∂rs√∂rjningskedjans s√§kerhet i praktiken
N√§r m√•nga servrar ska uppdateras regelbundet vill man ofta ha en egen, kontrollerad k√§lla. Ett lokalt repo ‚Äî som spegel, caching-proxy eller kuraterad k√§lla ‚Äî g√∂r att man kan granska och signera inneh√•ll, frysa en viss versionsm√§ngd och ‚Äúpromota‚Äù den fr√•n dev ‚Üí test ‚Üí prod. Det minskar exponeringen mot internet, ger f√∂ruts√§gbara byggen och g√∂r rollback enklare.
Exempel: Produktion pekar bara mot ‚Ä¶/prod/ och kr√§ver signerat index. Test pekar mot ‚Ä¶/test/ och f√•r nya paket en vecka tidigare. Uppt√§cks en regression i test, stannar promotion ‚Äî produktion p√•verkas inte.
S√• h√§r kan det se ut i Debian/Ubuntu-sp√•r (√∂versikt):‚Äî repo-servern har en egen GPG-nyckel; indexfiler signeras.‚Äî klienterna installerar din keyring och pekas mot din URL (med signed-by=).‚Äî pinning kan l√•sa s√• att inget annat arkiv anv√§nds av misstag.
Och i RHEL-sp√•r:‚Äî metadata genereras (t.ex. med createrepo_c), signeras och exponeras via HTTPS,‚Äî klienterna pekar p√• ditt baseurl och kr√§ver signatur/verifiering,‚Äî externa .repo-filer avaktiveras och egress kan st√§ngas i brandv√§gg.
### 5.3.9 Loggning och √∂vervakning
Om man vill kunna f√∂rst√• vad som h√§nt i efterhand ‚Äî eller uppt√§cka avvikelser i tid ‚Äî blir central loggning och egna m√§tv√§rden v√§rdefulla. I Linux b√∂rjar det i systemd-journald; sedan skickas loggar ofta vidare till t.ex. rsyslog och en central loggtj√§nst. F√∂r m√§tv√§rden anv√§nder m√•nga en liten agent (t.ex. node_exporter) och ett system som kan larma n√§r v√§rden avviker fr√•n det normala.
Exempel: SSH-inloggningar, sudo-f√∂rs√∂k och tj√§nstestarter skickas till en central vy. Ett enkelt larm reagerar om flera misslyckade inloggningar sker p√• kort tid.
### 5.3.10 Backup och √•terst√§llning
N√§r man pratar backup handlar det i grunden om att best√§mma RPO (hur mycket data man f√•r f√∂rlora) och RTO (hur snabbt det m√•ste g√• att komma tillbaka). P√• Linux √§r verktyg som restic eller borg vanliga f√∂r filniv√•backup (deduplicering och kryptering), medan hypervisorn ofta tar VM-backup. Det brukar bli mest robust att kombinera b√•da: en bild av hela VM:n och en applikationskonsistent backup av sj√§lva datan i g√§sten. Snapshots (t.ex. ZFS/LVM) kan hj√§lpa vid f√∂r√§ndringar ‚Äî men ses inte som backup i sig.
Exempel: Varje natt k√∂r restic till ett S3-kompatibelt objektlager (med immutabilitet). En g√•ng i veckan √•terst√§lls en verklig mapp till en ‚Äúkarant√§n-server‚Äù och j√§mf√∂rs med checksumma.
### 5.3.11 S√§kerhetsbaslinje ‚Äì hur ‚Äúbra‚Äù brukar se ut
M√•nga utg√•r fr√•n n√•gra √•terkommande byggstenar: SSH med nycklar (och g√§rna avst√§ngd l√∂senordsinloggning), default-deny i brandv√§ggen, fail2ban eller motsvarande f√∂r att d√§mpa bruteforce, ett MAC-skydd (AppArmor/SELinux) som faktiskt √§r p√•slaget, och enkel filintegritetskontroll p√• k√§nsliga system. Principen ‚Äúminsta privilegium‚Äù g√§ller i sudo/polkit ‚Äî tillr√§ckligt f√∂r att l√∂sa uppgiften, men inte mer.
Exempel: En bastion f√•r samma bas som √∂vriga, men med extra h√•rdning: enbart nyckel-SSH, tv√•faktor via PAM, stram polkit och realtidsloggning till SIEM.
### üìå Kontrollfr√•gor
- Vilka f√∂rdelar f√•r man av att beskriva Linux-servrar ‚Äúsom kod‚Äù, och hur p√•verkar det fels√∂kning och √•terst√§llning?
- N√§r kan en LTS-distribution vara ett klokt val, och vad vinner man p√• att fr√§mst anv√§nda standardarkiv?
- Hur skulle du motivera nyckelinloggning i SSH och loggning av f√∂rh√∂jda kommandon f√∂r en ny admin?
- Varf√∂r blir det l√§ttare att fels√∂ka om man h√•ller sig till ett n√§tkonfigurationss√§tt, och n√§r kommer VLAN/bond/bridge in i bilden?
- I vilka l√§gen k√§nns Samba/SMB respektive NFS mest naturligt, och hur p√•verkar valen r√§ttighetshanteringen?
- Vad kan AD/SSSD eller FreeIPA l√∂sa i central identitet, och vad beh√∂ver fortfarande styras lokalt (sudo/polkit)?
- Hur hj√§lper Ansible dig att h√•lla en baspolicy intakt, och vad betyder idempotens i vardagen?
- Hur kan man l√§gga upp uppdateringar i ringar f√∂r Linux, och varf√∂r brukar s√§kerhetsfixar g√• snabbare?
- Vad vinner man p√• lokala repos (spegel, proxy eller kuraterat), och hur h√§nger signering och promotion ihop med rollback?
- Hur kombinerar du VM-backup och g√§st-backup f√∂r att n√• RPO/RTO, och hur visar du att √•terst√§llning faktiskt fungerar?
Vilka f√∂rdelar f√•r man av att beskriva Linux-servrar ‚Äúsom kod‚Äù, och hur p√•verkar det fels√∂kning och √•terst√§llning?
N√§r kan en LTS-distribution vara ett klokt val, och vad vinner man p√• att fr√§mst anv√§nda standardarkiv?
Hur skulle du motivera nyckelinloggning i SSH och loggning av f√∂rh√∂jda kommandon f√∂r en ny admin?
Varf√∂r blir det l√§ttare att fels√∂ka om man h√•ller sig till ett n√§tkonfigurationss√§tt, och n√§r kommer VLAN/bond/bridge in i bilden?
I vilka l√§gen k√§nns Samba/SMB respektive NFS mest naturligt, och hur p√•verkar valen r√§ttighetshanteringen?
Vad kan AD/SSSD eller FreeIPA l√∂sa i central identitet, och vad beh√∂ver fortfarande styras lokalt (sudo/polkit)?
Hur hj√§lper Ansible dig att h√•lla en baspolicy intakt, och vad betyder idempotens i vardagen?
Hur kan man l√§gga upp uppdateringar i ringar f√∂r Linux, och varf√∂r brukar s√§kerhetsfixar g√• snabbare?
Vad vinner man p√• lokala repos (spegel, proxy eller kuraterat), och hur h√§nger signering och promotion ihop med rollback?
Hur kombinerar du VM-backup och g√§st-backup f√∂r att n√• RPO/RTO, och hur visar du att √•terst√§llning faktiskt fungerar?
### üîó F√∂rdjupningsl√§nkar
- Ubuntu Server Guide: https://ubuntu.com/server/docs
- Debian Admin Handbook: https://debian-handbook.info/
- Red Hat Enterprise Linux ‚Äì Security & Hardening: https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/
- Ansible Documentation: https://docs.ansible.com/
- Netplan Examples: https://netplan.io/examples
- OpenSSH manpages: https://man.openbsd.org/ssh_config
- Samba Documentation: https://www.samba.org/samba/docs/
- FreeIPA Documentation: https://www.freeipa.org/page/Documentation
- restic (backup): https://restic.net/
- Prometheus node_exporter: https://prometheus.io/docs/guides/node-exporter/
Ubuntu Server Guide: https://ubuntu.com/server/docs
Debian Admin Handbook: https://debian-handbook.info/
Red Hat Enterprise Linux ‚Äì Security & Hardening: https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/
Ansible Documentation: https://docs.ansible.com/
Netplan Examples: https://netplan.io/examples
OpenSSH manpages: https://man.openbsd.org/ssh_config
Samba Documentation: https://www.samba.org/samba/docs/
FreeIPA Documentation: https://www.freeipa.org/page/Documentation
restic (backup): https://restic.net/
Prometheus node_exporter: https://prometheus.io/docs/guides/node-exporter/
### ‚úçÔ∏è Egna anteckningar
‚Ä¶