# 4. Säkerhet och övervakning

## 4.1 Nätverkssäkerhetens grunder

### 4.1.1 Grundidéer: lager, rättigheter och synlighet

Nätverkssäkerhet handlar i grunden om att minska konsekvensen när något går fel, inte om att garantera att inget någonsin händer. Två idéer ramar in allt annat: försvar i flera lager (defense in depth) och minsta möjliga rättighet (least privilege). Lager-tänket gör att ett enskilt fel – en sårbar klient, ett läckt lösenord, en missad uppdatering – inte automatiskt blir ett stort driftstopp. Rättighetsprincipen gör att ett komprometterat konto eller en felkonfigurerad tjänst inte får mer makt än vad den faktiskt behöver. Allt detta står och faller med synlighet: utan loggar, larm och mätningar vet man varken vad som hände eller om åtgärden fungerade.

I praktiken börjar säkerhetsarbetet med tre frågor: Vad skyddas? Mot vad? Hur märks det? Tillgångar (elevdata, lärarmaterial, administration), hot (misstag, skadlig kod, obehörig åtkomst) och telemetri (loggar, larm, mätvärden). När det är definierat blir prioriteringen enklare: segmentering (VLAN/zoner), uppdateringar, stark identitet (MFA, gruppbaserad åtkomst), baspolicys (klient/servrar med brandvägg på) och loggning som faktiskt läses ger ofta mest effekt.

Förtydligande (sammanfattning):

- Lager: små fel blir inte stora.
- Rättigheter: konton/tjänster har bara det de behöver.
- Synlighet: utan logg/larm finns ingen säkerhet i praktiken.
- Prioritering: segmentering, patchning, stark identitet ger hög “träff per timme”.

Lager: små fel blir inte stora.

Rättigheter: konton/tjänster har bara det de behöver.

Synlighet: utan logg/larm finns ingen säkerhet i praktiken.

Prioritering: segmentering, patchning, stark identitet ger hög “träff per timme”.

Exempel: Elevklienter och serversystem ligger i olika VLAN. Även om en elevdator infekteras kan skadlig kod inte prata direkt med servern – brandvägg och routingregler står i vägen. Händelsen syns i loggarna och kan hanteras innan den sprider sig.

### 4.1.2 CIA-triaden

CIA-triaden beskriver tre mål: konfidentialitet (bara rätt mottagare kan läsa), integritet (data är oförändrad) och tillgänglighet (tjänsten fungerar när den behövs). Varje kontroll bör kunna motiveras med vilket C, I eller A den stöttar. Kryptering och behörighet skyddar C, signering och checksummer skyddar I, redundans och kapacitetsplanering skyddar A.

### 4.1.3 Brandväggar: klassisk → NGFW (Next-Generation Firewall)

Brandväggar uttrycker vad som är tillåtet mellan zoner; allt annat nekas. En klassisk, stateful brandvägg arbetar främst på lager 3/4: käll-/mål-IP, portar och protokoll, och håller reda på anslutningars tillstånd (t.ex. TCP SYN/ACK). Det räcker långt för kända flöden (“server X får prata TCP/443 ut”), men blir trubbigt när många applikationer delar samma portar.

En NGFW (Next-Generation Firewall) lägger till lager-7-förståelse. Den kan identifiera applikationer oavsett portar, koppla regler till användaridentitet (via t.ex. AD/Entra), och utföra innehållsinspektion. I praktiken innebär det moduler som IPS (Intrusion Prevention System), URL-/webbfiltrering, möjlighet till TLS-inspektion (dekryptera, kontrollera, kryptera om), sandboxning av misstänkta filer samt flöde av threat intelligence. Poängen är inte fler “knappar”, utan att policyn kan uttryckas närmare verksamheten: tillåt rätt tjänst för rätt grupp, blockera osäkra mönster.

Förtydligande (sammanfattning):

- Stateful brandvägg: IP/port/protokoll + tillstånd; enkel och snabb.
- NGFW: app-igenkänning (lager 7), identitetsmedvetna regler, IPS, URL-filter, ev. TLS-inspektion, sandboxning, hotflöden.
- Att tänka på: prestanda (särskilt TLS-inspektion), integritet/juridik, kompatibilitet (certifikat-pinning) och tydliga undantag.

Stateful brandvägg: IP/port/protokoll + tillstånd; enkel och snabb.

NGFW: app-igenkänning (lager 7), identitetsmedvetna regler, IPS, URL-filter, ev. TLS-inspektion, sandboxning, hotflöden.

Att tänka på: prestanda (särskilt TLS-inspektion), integritet/juridik, kompatibilitet (certifikat-pinning) och tydliga undantag.

Exempel: I en klassisk modell blir policyn “tillåt TCP/443 ut”, vilket i praktiken öppnar för “allt som talar HTTPS”. Med NGFW kan policyn i stället säga “tillåt Microsoft Update och ett fåtal samarbetsverktyg för Personal, men blockera okända TLS-appar och fildelning för Elever” – även om allt använder 443.

### 4.1.4 IDS/IPS (Intrusion Detection/Prevention System) – och samspelet med NGFW

IDS/IPS kompletterar brandväggar genom att fokusera på beteenden och mönster i trafiken snarare än bara källor och portar. En NIDS (Network Intrusion Detection System) observerar trafik i nätet – ofta via SPAN (Switched Port Analyzer) eller en TAP (Test Access Point) – och ser flöden mellan system (“north-south” mot internet och “east-west” mellan zoner). En HIDS (Host Intrusion Detection System) tittar inne i värden (processer, loggar, filändringar) och fångar sådant som inte alltid syns på nätet.

Detekteringsmetoderna är två: signaturbaserad detektering jämför mot kända mönster (snabb och exakt för det kända), medan anomalibas letar avvikelser från “normal” trafik (bättre chans på okända hot, men kräver inlärning och kan ge fler falsklarm). Körs motorn inline blir den IPS: samma analys, men med möjlighet att blockera eller reseta misstänkta förbindelser i realtid; körs den vid sidan om (out-of-band) är rollen att larma.

Placering och signal. Vid gränsen mot internet fångas angrepp utifrån, men mycket verksamhetslogik passerar internt mellan klient- och serverzoner; där ger en NIDS-sensor på rätt länk hög signal. Kryptering (t.ex. TLS) begränsar innehållsinsyn; då blir metadata (tidsmönster, anslutningsfrekvens, kända domäner/IP:er) och HIDS-telemetri extra värdefullt. Ofta används flera sensorer för att skapa sammanhang: NIDS ser oväntade anslutningar, HIDS ser onormala processer, och loggkällor (AD, brandvägg, proxy) fyller i tidslinjen.

NGFW och IDS/IPS i samspel. Många NGFW innehåller en IPS-motor. Det ger fördelen att stoppa välkända mönster i brandväggens policyflöde. Samtidigt behåller friliggande NIDS/HIDS värde: de kan placeras på andra länkar (t.ex. mellan klient- och serverzon) och fånga east-west-rörelser som inte passerar brandväggens kant, eller ge second opinion utan att riskera falskpositiv blockering. En vanlig väg är att börja i detekteringsläge och blockera först när regler har hög tillit – särskilt på systemkritiska länkar.

Förtydligande (sammanfattning):

- NIDS/HIDS: nät- respektive värd-perspektiv; kompletterar varandra.
- Signatur vs anomali: känt-snabbt kontra okänt-upptäckbart.
- Inline vs out-of-band: blockera vs larma.
- Samspelet: NGFW-IPS stoppar vid kanten; NIDS/HIDS ger djup och kontext internt.

NIDS/HIDS: nät- respektive värd-perspektiv; kompletterar varandra.

Signatur vs anomali: känt-snabbt kontra okänt-upptäckbart.

Inline vs out-of-band: blockera vs larma.

Samspelet: NGFW-IPS stoppar vid kanten; NIDS/HIDS ger djup och kontext internt.

Exempel: En serverzon visar plötsliga utgående anslutningar mot ovanliga mål. NIDS (via TAP) larmar för “rare outbound” och HIDS på samma server rapporterar nyskapade processer i ett ovanligt katalogträd. Brandväggen sätter en tillfällig block på utgående trafik från den servern (hög-tillitsregel i IPS-läget), och korrelation med AD-loggar visar ett läckt tjänstkonto som spärras och roteras.

### 4.1.5 Honeypots och honeytokens

Honeypots och deception skapar medvetna “mål” som ska vara tysta i normal drift. Poängen är inte att “locka angripare för sport”, utan att skapa tidig varning och telemetri i zoner där man i övrigt vill se så lite trafik som möjligt. En enkel variant är en honeytoken (falsk uppgift/fil) som larmar när den läses.

Förtydligande (sammanfattning):

- Syfte: blixtlampa – inte produktion.
- Placering: i zoner där legitim kontakt är sällsynt.
- Åtgärd: tydlig ägare och process när det blinkar.

Syfte: blixtlampa – inte produktion.

Placering: i zoner där legitim kontakt är sällsynt.

Åtgärd: tydlig ägare och process när det blinkar.

Exempel: En “tyst” filserver-alias annonseras internt. All aktivitet dit larmar – signal som annars hade drunknat bland normaltrafik.

### 4.1.6 Säkerhet i VLAN-design

VLAN är inte bara ordning och adressplan; det är ett säkerhetsverktyg. När zoner och flöden uttrycks i VLAN och routing/ACL minskar risken att “tillfälliga lösningar” skapar genvägar.

Återkommande byggstenar:

- Minimera trunkar och pruna (tillåt) bara relevanta VLAN per trunk; native VLAN sätts till ett oanvänt (t.ex. 999).
- BPDU Guard och PortFast på klientportar; Root Guard nära roten; storm-control för att dämpa toppar.
- DHCP Snooping (avgör vilka portar som får vara DHCP), Dynamic ARP Inspection (DAI), IP Source Guard i accesslagret.
- ACL på SVI (gateway): “default deny – öppna minsta möjliga”.
- Private VLAN där klienter i samma VLAN inte ska kunna prata direkt.
- 802.1X i accesslagret för att knyta identitet till port (MAB-fallback för skrivare/IoT).
- Separera managementytor (SSH/HTTPS/SNMP) i eget VLAN och nå dem via bastion/jump host.

Minimera trunkar och pruna (tillåt) bara relevanta VLAN per trunk; native VLAN sätts till ett oanvänt (t.ex. 999).

BPDU Guard och PortFast på klientportar; Root Guard nära roten; storm-control för att dämpa toppar.

DHCP Snooping (avgör vilka portar som får vara DHCP), Dynamic ARP Inspection (DAI), IP Source Guard i accesslagret.

ACL på SVI (gateway): “default deny – öppna minsta möjliga”.

Private VLAN där klienter i samma VLAN inte ska kunna prata direkt.

802.1X i accesslagret för att knyta identitet till port (MAB-fallback för skrivare/IoT).

Separera managementytor (SSH/HTTPS/SNMP) i eget VLAN och nå dem via bastion/jump host.

Förtydligande (sammanfattning):

- Zoner: klient, server, gäst, management – och uttryckta flöden.
- Accessskydd: skydda mot felkopplade switchar och kringutrustning.
- Förgiftning: Snooping/DAI/Source Guard hindrar “falska sanningskällor”.

Zoner: klient, server, gäst, management – och uttryckta flöden.

Accessskydd: skydda mot felkopplade switchar och kringutrustning.

Förgiftning: Snooping/DAI/Source Guard hindrar “falska sanningskällor”.

Exempel: Ett “mystiskt” DHCP-scope dyker upp – klienter får fel adresser. Med DHCP Snooping blockeras den privata routern, och Snooping-tabellen pekar ut exakt switchport. Port Security begränsar MAC-antal och dämpar effekten av medtagen utrustning.

### 4.1.7 Protokollanalys med Wireshark

Protokollanalys svarar på frågan vad som faktiskt hände. Wireshark blir då ett mikroskop som visar ramar, flaggor och tidslinjer. En bra metod undviker datatsjöar: börja med ett smalt syfte (“klienter får inte IP”, “långsam inloggning”), fånga så nära källan som möjligt (klient, port-SPAN, server), och filtrera både vid fångst och visning. Etik och lag spelar också in: minimera (bara det som behövs), begränsa innehåll (undvik att spara payload i onödan), och rensa material när analysen är klar.

Några vyer ger mycket värde: tidslinje, Follow Stream, I/O Graphs och Expert Information. Välkända filter: dhcp || bootp för adressdelning, dns för namn, arp för tabeller, icmp för nåbarhet, tcp.flags.syn==1 && tcp.flags.ack==0 för handskakningar, tcp.analysis.retransmission för störningar, tls.handshake för att se att TLS sker, ip.addr==X för att isolera en värd. På WLAN krävs ibland monitor-läge för att se råa 802.11-ramar – annars syns mest det som passerar via AP/controller.

Förtydligande (sammanfattning):

- Fråga först: vad vill tidslinjen bevisa eller motbevisa?
- Smala fångster: nära källan, kort tid, rätt filter.
- Hjälpytor: Follow Stream, Expert Info, I/O Graphs.
- Etik: fånga minsta möjliga, skydda, rensa.

Fråga först: vad vill tidslinjen bevisa eller motbevisa?

Smala fångster: nära källan, kort tid, rätt filter.

Hjälpytor: Follow Stream, Expert Info, I/O Graphs.

Etik: fånga minsta möjliga, skydda, rensa.

Exempel: Klienter “saknar IP” i ett VLAN. Fångst visar DISCOVER men inga OFFER. På uplinken saknas trusted-flagga i DHCP Snooping, så relätrafiken stoppas. När uplinken sätts som trusted syns OFFER/REQUEST/ACK och klienterna får adresser direkt.

### 

### 📌 Kontrollfrågor

- Vad menas med defense in depth och least privilege, och hur samverkar de?
- Koppla tre kontroller till C, I respektive A i CIA-triaden.
- Förklara skillnaden mellan stateful brandvägg och NGFW (Next-Generation Firewall).
- Vad gör en NIDS (Network Intrusion Detection System) respektive HIDS (Host Intrusion Detection System) – och när behövs båda?
- Hur skiljer sig IDS från IPS (Intrusion Prevention System), och vad innebär inline kontra out-of-band?
- Varför kan NIDS/HIDS vara värdefulla även när NGFW redan har IPS?
- Nämn fem byggstenar som stärker VLAN-säkerhet i accesslagret och motivera dem kort.
- Vad gör DHCP Snooping, DAI och IP Source Guard, och hur hänger de ihop?
- Beskriv en metod för att felsöka “långsam inloggning” med Wireshark utan att exponera onödig data.
- Ge tre visningsfilter i Wireshark som snabbt ringar in problem med DHCP, DNS och TCP-anslutningar.

Vad menas med defense in depth och least privilege, och hur samverkar de?

Koppla tre kontroller till C, I respektive A i CIA-triaden.

Förklara skillnaden mellan stateful brandvägg och NGFW (Next-Generation Firewall).

Vad gör en NIDS (Network Intrusion Detection System) respektive HIDS (Host Intrusion Detection System) – och när behövs båda?

Hur skiljer sig IDS från IPS (Intrusion Prevention System), och vad innebär inline kontra out-of-band?

Varför kan NIDS/HIDS vara värdefulla även när NGFW redan har IPS?

Nämn fem byggstenar som stärker VLAN-säkerhet i accesslagret och motivera dem kort.

Vad gör DHCP Snooping, DAI och IP Source Guard, och hur hänger de ihop?

Beskriv en metod för att felsöka “långsam inloggning” med Wireshark utan att exponera onödig data.

Ge tre visningsfilter i Wireshark som snabbt ringar in problem med DHCP, DNS och TCP-anslutningar.

### 

### 🔗 Fördjupningslänkar

- NIST – Computer Security Incident Handling (översikt): https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final
- NIST – Zero Trust (ramverkstänk): https://csrc.nist.gov/publications/detail/sp/800-207/final
- RFC 2131 – DHCP: https://www.rfc-editor.org/rfc/rfc2131
- RFC 1034/1035 – DNS grunder: https://www.rfc-editor.org/rfc/rfc1034
- RFC 826 – ARP: https://www.rfc-editor.org/rfc/rfc826
- RFC 8446 – TLS 1.3: https://www.rfc-editor.org/rfc/rfc8446
- Wireshark – User Guide: https://www.wireshark.org/docs/wsug_html_chunked/
- Cisco – Campus LAN Security (designidéer): https://www.cisco.com/c/en/us/solutions/enterprise-networks/index.html

NIST – Computer Security Incident Handling (översikt): https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final

NIST – Zero Trust (ramverkstänk): https://csrc.nist.gov/publications/detail/sp/800-207/final

RFC 2131 – DHCP: https://www.rfc-editor.org/rfc/rfc2131

RFC 1034/1035 – DNS grunder: https://www.rfc-editor.org/rfc/rfc1034

RFC 826 – ARP: https://www.rfc-editor.org/rfc/rfc826

RFC 8446 – TLS 1.3: https://www.rfc-editor.org/rfc/rfc8446

Wireshark – User Guide: https://www.wireshark.org/docs/wsug_html_chunked/

Cisco – Campus LAN Security (designidéer): https://www.cisco.com/c/en/us/solutions/enterprise-networks/index.html

### 

### ✍️ Egna anteckningar

…


