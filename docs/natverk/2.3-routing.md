# Kapitel 1 – Vad är ett nätverk?

## 2.3 Routing

### 2.3.1 Grunder: hur routrar väljer väg

Routing handlar om att välja bästa vägen för ett paket från källa till mål via en eller flera hopp. Varje router underhåller en routingtabell med nät (prefix), nästa hopp och utgående gränssnitt. När flera rutter matchar samma mål används längsta-prefix-match – den mest specifika (t.ex. /27) vinner över en mer generell (t.ex. /24). Om flera källor kan lägga in rutter (statisk, RIP, OSPF) avgör administrativ distans (AD) vilken källa som anses mest pålitlig, medan metric inom ett protokoll jämför alternativa vägar. Vid lika kostnad kan ECMP (Equal-Cost Multi-Path) dela lasten över flera lika bra vägar.

Metric är protokollens “kostnadsskala” (hop-count i RIP, bandbreddsbaserad kostnad i OSPF).

Exempel: Ett paket till 10.20.1.15 matchar både 0.0.0.0/0 och 10.20.0.0/22; längsta-prefix-match gör att /22 väljs.

### 2.3.2 Statisk routing – enkelhet och kontroll

Statisk routing innebär att administratören manuellt skriver in rutter. Det passar när topologin är liten eller stabil och när man vill ha full determinism i vägvalet. En klassiker är att lägga en standardrutt (0.0.0.0/0) mot internetleverantören, medan interna nät pekas explicit mot rätt nästa hopp. Du kan även använda “floating static” (statisk rutt med högre AD) som backup till en dynamisk rutt – den aktiveras bara när den dynamiska försvinner. Tänk på att statisk routing måste finnas åt båda håll (returväg), annars uppstår asymmetri och svarspaket hittar inte tillbaka.

Fördelar:

- Enkelt och förutsägbart – lätt att förstå och felsöka.
- Ingen protokollchatt – noll kontrolltrafik och minimal CPU-belastning.
- Fin kontroll – du bestämmer exakt vägval.
- Bra som backup – “floating static” tar över först vid fel.

Enkelt och förutsägbart – lätt att förstå och felsöka.

Ingen protokollchatt – noll kontrolltrafik och minimal CPU-belastning.

Fin kontroll – du bestämmer exakt vägval.

Bra som backup – “floating static” tar över först vid fel.

Nackdelar:

- Ingen självläkning – topologiändringar kräver manuell uppdatering.
- Skalar dåligt – många nät = många rader att underhålla.
- Risk för asymmetri/blackholes om returvägar missas.

Ingen självläkning – topologiändringar kräver manuell uppdatering.

Skalar dåligt – många nät = många rader att underhålla.

Risk för asymmetri/blackholes om returvägar missas.

Användningsområden:

- Små nät / labbar / edge mot internet (default route).
- Enkla hub-and-spoke (spoke pekar mot hub med statik).
- Backup-vägar (floating static bakom dynamik).

Små nät / labbar / edge mot internet (default route).

Enkla hub-and-spoke (spoke pekar mot hub med statik).

Backup-vägar (floating static bakom dynamik).

Exempel: Brandväggen har 0.0.0.0/0 mot ISP. Filialsubnet 10.50.0.0/16 pekas statiskt mot VPN-routern. Returväg från hub till filial summeras och annonseras tillbaka.

### 2.3.3 Dynamisk routing – när nätet ska anpassa sig själv

Dynamiska routingprotokoll låter routrar skapa grannrelationer (adjacencies), skicka hellos/uppdateringar och konvergera till en gemensam bild av nätet. De reagerar när en länk går ner, när ett nytt nät tillkommer eller när en kostnad ändras, och väljer då om väg automatiskt. Det minskar manuellt arbete, särskilt när antalet prefix och länkar växer, men introducerar också protokollbeteenden (timers, metrics, filtrering) som man behöver förstå. Grovt finns två familjer: distance-vector (t.ex. RIP) som vidareförmedlar information om “avstånd” till nät, och link-state (t.ex. OSPF) som delar topologi-information så att varje router själv räknar bästa vägar.

Fördelar (generellt):

- Självläkning – anpassar sig vid fel utan manuell insats.
- Skalbarhet – enklare när nät och sajter växer.
- Mindre manuellt pyssel – färre statiska rader att underhålla.

Självläkning – anpassar sig vid fel utan manuell insats.

Skalbarhet – enklare när nät och sajter växer.

Mindre manuellt pyssel – färre statiska rader att underhålla.

Nackdelar (generellt):

- Ökad komplexitet – grannskap, timers, filtrering, autentisering.
- Protokolltrafik – viss overhead och potentiella angreppsytor.
- Felkonfiguration kostar – felaktiga parametrar kan ge sämre vägar.

Ökad komplexitet – grannskap, timers, filtrering, autentisering.

Protokolltrafik – viss overhead och potentiella angreppsytor.

Felkonfiguration kostar – felaktiga parametrar kan ge sämre vägar.

### 2.3.4 RIP v2 – enkelt och pedagogiskt

Observera: RIP v2 rekommenderas sällan i produktion p.g.a. långsam konvergens, hop-begränsning, enkel metric och loopsäkerhet — bra pedagogiskt, men skala/snabb återhämtning kräver ofta OSPF eller liknande.

RIP v2 är ett distance-vector-protokoll som använder hop-count som metric (max 15 hopp). Routrar skickar periodiska uppdateringar (typiskt var 30:e sekund) till sina grannar. För att minska loopar används tekniker som split horizon, poison reverse och hold-down timers, men vid större eller mer dynamiska nät blir konvergensen ändå långsam. Fördelen är att det är enkelt att konfigurera och mycket pedagogiskt för att förstå routinggrunder.

Fördelar:

- Mycket enkelt – snabbt att få igång i labb/mindre nät.
- Stöd för VLSM/CIDR (till skillnad från v1).
- Bred kompatibilitet – finns på många plattformar.

Mycket enkelt – snabbt att få igång i labb/mindre nät.

Stöd för VLSM/CIDR (till skillnad från v1).

Bred kompatibilitet – finns på många plattformar.

Nackdelar:

- Skalar dåligt – 15 hopp-begränsning.
- Långsam konvergens – periodiska uppdateringar; “count-to-infinity”-problem.
- Grovt metric – tar inte hänsyn till bandbredd/kvalitet.

Skalar dåligt – 15 hopp-begränsning.

Långsam konvergens – periodiska uppdateringar; “count-to-infinity”-problem.

Grovt metric – tar inte hänsyn till bandbredd/kvalitet.

Användningsområden:

- Utbildning och små labbnät (visa principer).
- Mycket små, statiska miljöer där enkelhet > prestanda.
- Temporära proof-of-concept där snabb uppstart är viktig.

Utbildning och små labbnät (visa principer).

Mycket små, statiska miljöer där enkelhet > prestanda.

Temporära proof-of-concept där snabb uppstart är viktig.

Exempel: Tre routrar i triangel kör RIP v2. En länk bryts → efter en stund räknar hop-count upp och trafiken hittar alternativ väg, men med märkbar fördröjning.

### 2.3.5 OSPF – snabbt och skalbart

Miniprofil: Area 0 som ryggrad; kostnad baserad på bandbredd; DR/BDR i delade L2-segment; summering/filtrering vid area-gränser; autentisering rekommenderas.

OSPF är ett link-state-protokoll där varje router annonserar länkstatus via LSAs (Link-State Advertisements). Alla i samma område bygger en topologikarta och räknar bästa vägar med Dijkstras algoritm. OSPF konvergerar snabbt, och genom att dela upp nätet i områden (med Area 0 som ryggrad) kan man skala till många prefix utan att varje enhet behöver hela världens detaljer. I Ethernet-segment väljs DR/BDR (Designated/Backup Designated Router) för att minska antalet grannrelationer. OSPF stödjer autentisering, summering, filtrering och olika area-typer (t.ex. stub/NSSA) för att minska brus.

Fördelar:

- Snabb konvergens – reagerar snabbt på fel.
- Skalbar arkitektur – areas minskar databas och uppdateringar.
- Finare metric – bandbreddsbaserad kostnad ger bättre vägval.
- Många verktyg – summering, filtrering, autentisering.

Snabb konvergens – reagerar snabbt på fel.

Skalbar arkitektur – areas minskar databas och uppdateringar.

Finare metric – bandbreddsbaserad kostnad ger bättre vägval.

Många verktyg – summering, filtrering, autentisering.

Nackdelar:

- Mer komplext – kräver förståelse för areas, LSAs, timers och adjacency-tillstånd.
- Kräver korrekt design – fel DR/BDR-placering eller area-gränser kan skapa problem.
- Lite mer overhead än statik/RIP.

Mer komplext – kräver förståelse för areas, LSAs, timers och adjacency-tillstånd.

Kräver korrekt design – fel DR/BDR-placering eller area-gränser kan skapa problem.

Lite mer overhead än statik/RIP.

Användningsområden:

- Campus/enterprise (medel–stora till stora nät).
- Miljöer med redundans där snabb återhämtning behövs.
- Nät med många VLAN/subnät där summering/areas ger ordning.

Campus/enterprise (medel–stora till stora nät).

Miljöer med redundans där snabb återhämtning behövs.

Nät med många VLAN/subnät där summering/areas ger ordning.

Exempel: Distributionen i två hus kör OSPF Area 0; våningsplanen är egna areas. Vid fiberbrott floods en LSA, alla räknar om, och trafiken går sekundär väg på under en sekund.

### 2.3.6 Första-hopp-redundans – VRRP/HSRP

Klienter skickar sin trafik till en default gateway i det egna VLAN:et. För att slippa avbrott när en gateway faller använder man första-hopp-redundansprotokoll: VRRP (öppen standard) eller HSRP (Cisco). Två (eller fler) routrar delar en virtuell IP och virtuell MAC; en är aktiv/master, och en standby som tar över när den aktiva faller. Övertagandet annonseras ofta via gratuitous ARP, så klienterna fortsätter prata med samma adress. Med preemption kan den “bästa” enheten ta tillbaka rollen när den är frisk, och med tracking kan man sänka prioritet om en kritisk länk bakom gatewayn går ner.

Fördelar:

- Transparent för klienter – samma gateway-IP lever vidare vid fel.
- Enkelt koncept – lätt att förstå, testa och dokumentera.
- Flexibelt – preemption/track ger snabb och rätt failover.

Transparent för klienter – samma gateway-IP lever vidare vid fel.

Enkelt koncept – lätt att förstå, testa och dokumentera.

Flexibelt – preemption/track ger snabb och rätt failover.

Nackdelar:

- Ytterligare protokoll att hantera – prioritet, timers, tracking måste hållas rätt.
- Ingen automatisk lastdelning (GLBP kan, men är ovanligt/leverantörsbundet).
- Löser bara gateway-resiliens – inte bakomliggande routing- eller brandväggsproblem.

Ytterligare protokoll att hantera – prioritet, timers, tracking måste hållas rätt.

Ingen automatisk lastdelning (GLBP kan, men är ovanligt/leverantörsbundet).

Löser bara gateway-resiliens – inte bakomliggande routing- eller brandväggsproblem.

Användningsområden:

- VLAN-gateways i distribution/core där hög tillgänglighet krävs.
- Migrering/underhåll – byt hårdvara utan klientstopp.

VLAN-gateways i distribution/core där hög tillgänglighet krävs.

Migrering/underhåll – byt hårdvara utan klientstopp.

Exempel: VLAN 10 har gateway 10.10.0.1 (virtuell). Dist-SW-A är aktiv, Dist-SW-B standby. Vid service tar B över – eleverna märker inget.

### 2.3.7 Summering och PBR – kontroll och städning

Prefix-summering innebär att annonsera ett större sammanhållet prefix i stället för många små. Det “städar” routingtabeller, minskar CPU-belastning och dämpar uppdateringar över länkar mellan sajter. För att påverka vägval för specifik trafik kan Policy-Based Routing (PBR) användas – t.ex. att viss källadress eller applikation styrs via en sekundär internetlänk eller en proxy. PBR kräver noggrann dokumentation och ofta övervakad next-hop (t.ex. SLA/track) så att policyn inte skickar trafik mot en död länk.

Fördelar:

- Summering: mindre tabeller och mindre brus mellan sajter.
- PBR: granular kontroll för särskilda flöden (compliance/prestanda).

Summering: mindre tabeller och mindre brus mellan sajter.

PBR: granular kontroll för särskilda flöden (compliance/prestanda).

Nackdelar:

- Summering: kräver planerad adressering; risk att “gömma” fel under en bred annons.
- PBR: ökar komplexitet; kan bryta “bästa-väg”-logiken och försvåra felsökning.

Summering: kräver planerad adressering; risk att “gömma” fel under en bred annons.

PBR: ökar komplexitet; kan bryta “bästa-väg”-logiken och försvåra felsökning.

Användningsområden:

- Större nät med OSPF – summera per site/area-gräns.
- Speciella trafikfall – dirigera vissa källor/appar via annan länk/proxy.

Större nät med OSPF – summera per site/area-gräns.

Speciella trafikfall – dirigera vissa källor/appar via annan länk/proxy.

### 2.3.8 Felsökning och validering

Felsök routing lager för lager: verifiera länkstatus, ARP/ND, gateway, routingtabell och slutligen applikationen. Kontrollera sedan protokollstatus (grannar, timers, tabeller) och brandväggspolicys längs vägen. Dokumentera förändringar och mät före/efter när du justerar metric, AD eller summeringar.

Förtydligande:

- Grundverktyg: ping, traceroute/tracert, arp -a, ip neigh, ip route/route print.
- På nätutrustning: show ip route, show ip ospf neighbor, show ip protocols, show interfaces.
- Vanliga fel: saknad default, fel nästa hopp, överlappande prefix, asymmetrisk routing, blockerad port i brandvägg.

Grundverktyg: ping, traceroute/tracert, arp -a, ip neigh, ip route/route print.

På nätutrustning: show ip route, show ip ospf neighbor, show ip protocols, show interfaces.

Vanliga fel: saknad default, fel nästa hopp, överlappande prefix, asymmetrisk routing, blockerad port i brandvägg.

Exempel: Klient når internet men inte filialserver: traceroute stannar efter brandvägg; inter-VLAN-regeln saknar tillåtelse mot 10.50.0.0/16 — lägg regel, testa igen.

### 

### 📌 Kontrollfrågor

- Vad innebär längsta-prefix-match och varför är den viktig?
- När passar statiska rutter bättre än dynamiska protokoll?
- Förklara skillnaden mellan administrativ distans och metric.
- Nämn två begränsningar i RIP v2 och varför de spelar roll.
- Hur skiljer sig OSPF:s arbetssätt från RIP:s?
- Vad är syftet med OSPF-områden och vilken roll har Area 0?
- Vad gör DR/BDR i OSPF och i vilken typ av nät väljs de?
- Hur fungerar VRRP/HSRP och varför behövs de?
- Vad är prefix-summering och vilket problem löser den?
- Lista fyra kommandon du använder först när routing “inte funkar”.

Vad innebär längsta-prefix-match och varför är den viktig?

När passar statiska rutter bättre än dynamiska protokoll?

Förklara skillnaden mellan administrativ distans och metric.

Nämn två begränsningar i RIP v2 och varför de spelar roll.

Hur skiljer sig OSPF:s arbetssätt från RIP:s?

Vad är syftet med OSPF-områden och vilken roll har Area 0?

Vad gör DR/BDR i OSPF och i vilken typ av nät väljs de?

Hur fungerar VRRP/HSRP och varför behövs de?

Vad är prefix-summering och vilket problem löser den?

Lista fyra kommandon du använder först när routing “inte funkar”.

### 

### 🔗 Fördjupningslänkar

- https://www.rfc-editor.org/rfc/rfc2453 (RIP v2)
- https://www.rfc-editor.org/rfc/rfc2328 (OSPFv2)
- https://www.rfc-editor.org/rfc/rfc5798 (VRRPv3)
- https://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/7039-1.html
- https://www.juniper.net/documentation/us/en/software/junos/routing-policy/topics/concept/policy-basics.html

https://www.rfc-editor.org/rfc/rfc2453 (RIP v2)

https://www.rfc-editor.org/rfc/rfc2328 (OSPFv2)

https://www.rfc-editor.org/rfc/rfc5798 (VRRPv3)

https://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/7039-1.html

https://www.juniper.net/documentation/us/en/software/junos/routing-policy/topics/concept/policy-basics.html

### 

### ✍️ Egna anteckningar

…


