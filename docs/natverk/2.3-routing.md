# Kapitel 1 ‚Äì Vad √§r ett n√§tverk?

## 2.3 Routing

### 2.3.1 Grunder: hur routrar v√§ljer v√§g

Routing handlar om att v√§lja b√§sta v√§gen f√∂r ett paket fr√•n k√§lla till m√•l via en eller flera hopp. Varje router underh√•ller en routingtabell med n√§t (prefix), n√§sta hopp och utg√•ende gr√§nssnitt. N√§r flera rutter matchar samma m√•l anv√§nds l√§ngsta-prefix-match ‚Äì den mest specifika (t.ex. /27) vinner √∂ver en mer generell (t.ex. /24). Om flera k√§llor kan l√§gga in rutter (statisk, RIP, OSPF) avg√∂r administrativ distans (AD) vilken k√§lla som anses mest p√•litlig, medan metric inom ett protokoll j√§mf√∂r alternativa v√§gar. Vid lika kostnad kan ECMP (Equal-Cost Multi-Path) dela lasten √∂ver flera lika bra v√§gar.

Metric √§r protokollens ‚Äúkostnadsskala‚Äù (hop-count i RIP, bandbreddsbaserad kostnad i OSPF).

Exempel: Ett paket till 10.20.1.15 matchar b√•de 0.0.0.0/0 och 10.20.0.0/22; l√§ngsta-prefix-match g√∂r att /22 v√§ljs.

### 2.3.2 Statisk routing ‚Äì enkelhet och kontroll

Statisk routing inneb√§r att administrat√∂ren manuellt skriver in rutter. Det passar n√§r topologin √§r liten eller stabil och n√§r man vill ha full determinism i v√§gvalet. En klassiker √§r att l√§gga en standardrutt (0.0.0.0/0) mot internetleverant√∂ren, medan interna n√§t pekas explicit mot r√§tt n√§sta hopp. Du kan √§ven anv√§nda ‚Äúfloating static‚Äù (statisk rutt med h√∂gre AD) som backup till en dynamisk rutt ‚Äì den aktiveras bara n√§r den dynamiska f√∂rsvinner. T√§nk p√• att statisk routing m√•ste finnas √•t b√•da h√•ll (returv√§g), annars uppst√•r asymmetri och svarspaket hittar inte tillbaka.

F√∂rdelar:

- Enkelt och f√∂ruts√§gbart ‚Äì l√§tt att f√∂rst√• och fels√∂ka.
- Ingen protokollchatt ‚Äì noll kontrolltrafik och minimal CPU-belastning.
- Fin kontroll ‚Äì du best√§mmer exakt v√§gval.
- Bra som backup ‚Äì ‚Äúfloating static‚Äù tar √∂ver f√∂rst vid fel.

Enkelt och f√∂ruts√§gbart ‚Äì l√§tt att f√∂rst√• och fels√∂ka.

Ingen protokollchatt ‚Äì noll kontrolltrafik och minimal CPU-belastning.

Fin kontroll ‚Äì du best√§mmer exakt v√§gval.

Bra som backup ‚Äì ‚Äúfloating static‚Äù tar √∂ver f√∂rst vid fel.

Nackdelar:

- Ingen sj√§lvl√§kning ‚Äì topologi√§ndringar kr√§ver manuell uppdatering.
- Skalar d√•ligt ‚Äì m√•nga n√§t = m√•nga rader att underh√•lla.
- Risk f√∂r asymmetri/blackholes om returv√§gar missas.

Ingen sj√§lvl√§kning ‚Äì topologi√§ndringar kr√§ver manuell uppdatering.

Skalar d√•ligt ‚Äì m√•nga n√§t = m√•nga rader att underh√•lla.

Risk f√∂r asymmetri/blackholes om returv√§gar missas.

Anv√§ndningsomr√•den:

- Sm√• n√§t / labbar / edge mot internet (default route).
- Enkla hub-and-spoke (spoke pekar mot hub med statik).
- Backup-v√§gar (floating static bakom dynamik).

Sm√• n√§t / labbar / edge mot internet (default route).

Enkla hub-and-spoke (spoke pekar mot hub med statik).

Backup-v√§gar (floating static bakom dynamik).

Exempel: Brandv√§ggen har 0.0.0.0/0 mot ISP. Filialsubnet 10.50.0.0/16 pekas statiskt mot VPN-routern. Returv√§g fr√•n hub till filial summeras och annonseras tillbaka.

### 2.3.3 Dynamisk routing ‚Äì n√§r n√§tet ska anpassa sig sj√§lv

Dynamiska routingprotokoll l√•ter routrar skapa grannrelationer (adjacencies), skicka hellos/uppdateringar och konvergera till en gemensam bild av n√§tet. De reagerar n√§r en l√§nk g√•r ner, n√§r ett nytt n√§t tillkommer eller n√§r en kostnad √§ndras, och v√§ljer d√• om v√§g automatiskt. Det minskar manuellt arbete, s√§rskilt n√§r antalet prefix och l√§nkar v√§xer, men introducerar ocks√• protokollbeteenden (timers, metrics, filtrering) som man beh√∂ver f√∂rst√•. Grovt finns tv√• familjer: distance-vector (t.ex. RIP) som vidaref√∂rmedlar information om ‚Äúavst√•nd‚Äù till n√§t, och link-state (t.ex. OSPF) som delar topologi-information s√• att varje router sj√§lv r√§knar b√§sta v√§gar.

F√∂rdelar (generellt):

- Sj√§lvl√§kning ‚Äì anpassar sig vid fel utan manuell insats.
- Skalbarhet ‚Äì enklare n√§r n√§t och sajter v√§xer.
- Mindre manuellt pyssel ‚Äì f√§rre statiska rader att underh√•lla.

Sj√§lvl√§kning ‚Äì anpassar sig vid fel utan manuell insats.

Skalbarhet ‚Äì enklare n√§r n√§t och sajter v√§xer.

Mindre manuellt pyssel ‚Äì f√§rre statiska rader att underh√•lla.

Nackdelar (generellt):

- √ñkad komplexitet ‚Äì grannskap, timers, filtrering, autentisering.
- Protokolltrafik ‚Äì viss overhead och potentiella angreppsytor.
- Felkonfiguration kostar ‚Äì felaktiga parametrar kan ge s√§mre v√§gar.

√ñkad komplexitet ‚Äì grannskap, timers, filtrering, autentisering.

Protokolltrafik ‚Äì viss overhead och potentiella angreppsytor.

Felkonfiguration kostar ‚Äì felaktiga parametrar kan ge s√§mre v√§gar.

### 2.3.4 RIP v2 ‚Äì enkelt och pedagogiskt

Observera: RIP v2 rekommenderas s√§llan i produktion p.g.a. l√•ngsam konvergens, hop-begr√§nsning, enkel metric och loops√§kerhet ‚Äî bra pedagogiskt, men skala/snabb √•terh√§mtning kr√§ver ofta OSPF eller liknande.

RIP v2 √§r ett distance-vector-protokoll som anv√§nder hop-count som metric (max 15 hopp). Routrar skickar periodiska uppdateringar (typiskt var 30:e sekund) till sina grannar. F√∂r att minska loopar anv√§nds tekniker som split horizon, poison reverse och hold-down timers, men vid st√∂rre eller mer dynamiska n√§t blir konvergensen √§nd√• l√•ngsam. F√∂rdelen √§r att det √§r enkelt att konfigurera och mycket pedagogiskt f√∂r att f√∂rst√• routinggrunder.

F√∂rdelar:

- Mycket enkelt ‚Äì snabbt att f√• ig√•ng i labb/mindre n√§t.
- St√∂d f√∂r VLSM/CIDR (till skillnad fr√•n v1).
- Bred kompatibilitet ‚Äì finns p√• m√•nga plattformar.

Mycket enkelt ‚Äì snabbt att f√• ig√•ng i labb/mindre n√§t.

St√∂d f√∂r VLSM/CIDR (till skillnad fr√•n v1).

Bred kompatibilitet ‚Äì finns p√• m√•nga plattformar.

Nackdelar:

- Skalar d√•ligt ‚Äì 15 hopp-begr√§nsning.
- L√•ngsam konvergens ‚Äì periodiska uppdateringar; ‚Äúcount-to-infinity‚Äù-problem.
- Grovt metric ‚Äì tar inte h√§nsyn till bandbredd/kvalitet.

Skalar d√•ligt ‚Äì 15 hopp-begr√§nsning.

L√•ngsam konvergens ‚Äì periodiska uppdateringar; ‚Äúcount-to-infinity‚Äù-problem.

Grovt metric ‚Äì tar inte h√§nsyn till bandbredd/kvalitet.

Anv√§ndningsomr√•den:

- Utbildning och sm√• labbn√§t (visa principer).
- Mycket sm√•, statiska milj√∂er d√§r enkelhet > prestanda.
- Tempor√§ra proof-of-concept d√§r snabb uppstart √§r viktig.

Utbildning och sm√• labbn√§t (visa principer).

Mycket sm√•, statiska milj√∂er d√§r enkelhet > prestanda.

Tempor√§ra proof-of-concept d√§r snabb uppstart √§r viktig.

Exempel: Tre routrar i triangel k√∂r RIP v2. En l√§nk bryts ‚Üí efter en stund r√§knar hop-count upp och trafiken hittar alternativ v√§g, men med m√§rkbar f√∂rdr√∂jning.

### 2.3.5 OSPF ‚Äì snabbt och skalbart

Miniprofil: Area 0 som ryggrad; kostnad baserad p√• bandbredd; DR/BDR i delade L2-segment; summering/filtrering vid area-gr√§nser; autentisering rekommenderas.

OSPF √§r ett link-state-protokoll d√§r varje router annonserar l√§nkstatus via LSAs (Link-State Advertisements). Alla i samma omr√•de bygger en topologikarta och r√§knar b√§sta v√§gar med Dijkstras algoritm. OSPF konvergerar snabbt, och genom att dela upp n√§tet i omr√•den (med Area 0 som ryggrad) kan man skala till m√•nga prefix utan att varje enhet beh√∂ver hela v√§rldens detaljer. I Ethernet-segment v√§ljs DR/BDR (Designated/Backup Designated Router) f√∂r att minska antalet grannrelationer. OSPF st√∂djer autentisering, summering, filtrering och olika area-typer (t.ex. stub/NSSA) f√∂r att minska brus.

F√∂rdelar:

- Snabb konvergens ‚Äì reagerar snabbt p√• fel.
- Skalbar arkitektur ‚Äì areas minskar databas och uppdateringar.
- Finare metric ‚Äì bandbreddsbaserad kostnad ger b√§ttre v√§gval.
- M√•nga verktyg ‚Äì summering, filtrering, autentisering.

Snabb konvergens ‚Äì reagerar snabbt p√• fel.

Skalbar arkitektur ‚Äì areas minskar databas och uppdateringar.

Finare metric ‚Äì bandbreddsbaserad kostnad ger b√§ttre v√§gval.

M√•nga verktyg ‚Äì summering, filtrering, autentisering.

Nackdelar:

- Mer komplext ‚Äì kr√§ver f√∂rst√•else f√∂r areas, LSAs, timers och adjacency-tillst√•nd.
- Kr√§ver korrekt design ‚Äì fel DR/BDR-placering eller area-gr√§nser kan skapa problem.
- Lite mer overhead √§n statik/RIP.

Mer komplext ‚Äì kr√§ver f√∂rst√•else f√∂r areas, LSAs, timers och adjacency-tillst√•nd.

Kr√§ver korrekt design ‚Äì fel DR/BDR-placering eller area-gr√§nser kan skapa problem.

Lite mer overhead √§n statik/RIP.

Anv√§ndningsomr√•den:

- Campus/enterprise (medel‚Äìstora till stora n√§t).
- Milj√∂er med redundans d√§r snabb √•terh√§mtning beh√∂vs.
- N√§t med m√•nga VLAN/subn√§t d√§r summering/areas ger ordning.

Campus/enterprise (medel‚Äìstora till stora n√§t).

Milj√∂er med redundans d√§r snabb √•terh√§mtning beh√∂vs.

N√§t med m√•nga VLAN/subn√§t d√§r summering/areas ger ordning.

Exempel: Distributionen i tv√• hus k√∂r OSPF Area 0; v√•ningsplanen √§r egna areas. Vid fiberbrott floods en LSA, alla r√§knar om, och trafiken g√•r sekund√§r v√§g p√• under en sekund.

### 2.3.6 F√∂rsta-hopp-redundans ‚Äì VRRP/HSRP

Klienter skickar sin trafik till en default gateway i det egna VLAN:et. F√∂r att slippa avbrott n√§r en gateway faller anv√§nder man f√∂rsta-hopp-redundansprotokoll: VRRP (√∂ppen standard) eller HSRP (Cisco). Tv√• (eller fler) routrar delar en virtuell IP och virtuell MAC; en √§r aktiv/master, och en standby som tar √∂ver n√§r den aktiva faller. √ñvertagandet annonseras ofta via gratuitous ARP, s√• klienterna forts√§tter prata med samma adress. Med preemption kan den ‚Äúb√§sta‚Äù enheten ta tillbaka rollen n√§r den √§r frisk, och med tracking kan man s√§nka prioritet om en kritisk l√§nk bakom gatewayn g√•r ner.

F√∂rdelar:

- Transparent f√∂r klienter ‚Äì samma gateway-IP lever vidare vid fel.
- Enkelt koncept ‚Äì l√§tt att f√∂rst√•, testa och dokumentera.
- Flexibelt ‚Äì preemption/track ger snabb och r√§tt failover.

Transparent f√∂r klienter ‚Äì samma gateway-IP lever vidare vid fel.

Enkelt koncept ‚Äì l√§tt att f√∂rst√•, testa och dokumentera.

Flexibelt ‚Äì preemption/track ger snabb och r√§tt failover.

Nackdelar:

- Ytterligare protokoll att hantera ‚Äì prioritet, timers, tracking m√•ste h√•llas r√§tt.
- Ingen automatisk lastdelning (GLBP kan, men √§r ovanligt/leverant√∂rsbundet).
- L√∂ser bara gateway-resiliens ‚Äì inte bakomliggande routing- eller brandv√§ggsproblem.

Ytterligare protokoll att hantera ‚Äì prioritet, timers, tracking m√•ste h√•llas r√§tt.

Ingen automatisk lastdelning (GLBP kan, men √§r ovanligt/leverant√∂rsbundet).

L√∂ser bara gateway-resiliens ‚Äì inte bakomliggande routing- eller brandv√§ggsproblem.

Anv√§ndningsomr√•den:

- VLAN-gateways i distribution/core d√§r h√∂g tillg√§nglighet kr√§vs.
- Migrering/underh√•ll ‚Äì byt h√•rdvara utan klientstopp.

VLAN-gateways i distribution/core d√§r h√∂g tillg√§nglighet kr√§vs.

Migrering/underh√•ll ‚Äì byt h√•rdvara utan klientstopp.

Exempel: VLAN 10 har gateway 10.10.0.1 (virtuell). Dist-SW-A √§r aktiv, Dist-SW-B standby. Vid service tar B √∂ver ‚Äì eleverna m√§rker inget.

### 2.3.7 Summering och PBR ‚Äì kontroll och st√§dning

Prefix-summering inneb√§r att annonsera ett st√∂rre sammanh√•llet prefix i st√§llet f√∂r m√•nga sm√•. Det ‚Äúst√§dar‚Äù routingtabeller, minskar CPU-belastning och d√§mpar uppdateringar √∂ver l√§nkar mellan sajter. F√∂r att p√•verka v√§gval f√∂r specifik trafik kan Policy-Based Routing (PBR) anv√§ndas ‚Äì t.ex. att viss k√§lladress eller applikation styrs via en sekund√§r internetl√§nk eller en proxy. PBR kr√§ver noggrann dokumentation och ofta √∂vervakad next-hop (t.ex. SLA/track) s√• att policyn inte skickar trafik mot en d√∂d l√§nk.

F√∂rdelar:

- Summering: mindre tabeller och mindre brus mellan sajter.
- PBR: granular kontroll f√∂r s√§rskilda fl√∂den (compliance/prestanda).

Summering: mindre tabeller och mindre brus mellan sajter.

PBR: granular kontroll f√∂r s√§rskilda fl√∂den (compliance/prestanda).

Nackdelar:

- Summering: kr√§ver planerad adressering; risk att ‚Äúg√∂mma‚Äù fel under en bred annons.
- PBR: √∂kar komplexitet; kan bryta ‚Äúb√§sta-v√§g‚Äù-logiken och f√∂rsv√•ra fels√∂kning.

Summering: kr√§ver planerad adressering; risk att ‚Äúg√∂mma‚Äù fel under en bred annons.

PBR: √∂kar komplexitet; kan bryta ‚Äúb√§sta-v√§g‚Äù-logiken och f√∂rsv√•ra fels√∂kning.

Anv√§ndningsomr√•den:

- St√∂rre n√§t med OSPF ‚Äì summera per site/area-gr√§ns.
- Speciella trafikfall ‚Äì dirigera vissa k√§llor/appar via annan l√§nk/proxy.

St√∂rre n√§t med OSPF ‚Äì summera per site/area-gr√§ns.

Speciella trafikfall ‚Äì dirigera vissa k√§llor/appar via annan l√§nk/proxy.

### 2.3.8 Fels√∂kning och validering

Fels√∂k routing lager f√∂r lager: verifiera l√§nkstatus, ARP/ND, gateway, routingtabell och slutligen applikationen. Kontrollera sedan protokollstatus (grannar, timers, tabeller) och brandv√§ggspolicys l√§ngs v√§gen. Dokumentera f√∂r√§ndringar och m√§t f√∂re/efter n√§r du justerar metric, AD eller summeringar.

F√∂rtydligande:

- Grundverktyg: ping, traceroute/tracert, arp -a, ip neigh, ip route/route print.
- P√• n√§tutrustning: show ip route, show ip ospf neighbor, show ip protocols, show interfaces.
- Vanliga fel: saknad default, fel n√§sta hopp, √∂verlappande prefix, asymmetrisk routing, blockerad port i brandv√§gg.

Grundverktyg: ping, traceroute/tracert, arp -a, ip neigh, ip route/route print.

P√• n√§tutrustning: show ip route, show ip ospf neighbor, show ip protocols, show interfaces.

Vanliga fel: saknad default, fel n√§sta hopp, √∂verlappande prefix, asymmetrisk routing, blockerad port i brandv√§gg.

Exempel: Klient n√•r internet men inte filialserver: traceroute stannar efter brandv√§gg; inter-VLAN-regeln saknar till√•telse mot 10.50.0.0/16 ‚Äî l√§gg regel, testa igen.

### 

### üìå Kontrollfr√•gor

- Vad inneb√§r l√§ngsta-prefix-match och varf√∂r √§r den viktig?
- N√§r passar statiska rutter b√§ttre √§n dynamiska protokoll?
- F√∂rklara skillnaden mellan administrativ distans och metric.
- N√§mn tv√• begr√§nsningar i RIP v2 och varf√∂r de spelar roll.
- Hur skiljer sig OSPF:s arbetss√§tt fr√•n RIP:s?
- Vad √§r syftet med OSPF-omr√•den och vilken roll har Area 0?
- Vad g√∂r DR/BDR i OSPF och i vilken typ av n√§t v√§ljs de?
- Hur fungerar VRRP/HSRP och varf√∂r beh√∂vs de?
- Vad √§r prefix-summering och vilket problem l√∂ser den?
- Lista fyra kommandon du anv√§nder f√∂rst n√§r routing ‚Äúinte funkar‚Äù.

Vad inneb√§r l√§ngsta-prefix-match och varf√∂r √§r den viktig?

N√§r passar statiska rutter b√§ttre √§n dynamiska protokoll?

F√∂rklara skillnaden mellan administrativ distans och metric.

N√§mn tv√• begr√§nsningar i RIP v2 och varf√∂r de spelar roll.

Hur skiljer sig OSPF:s arbetss√§tt fr√•n RIP:s?

Vad √§r syftet med OSPF-omr√•den och vilken roll har Area 0?

Vad g√∂r DR/BDR i OSPF och i vilken typ av n√§t v√§ljs de?

Hur fungerar VRRP/HSRP och varf√∂r beh√∂vs de?

Vad √§r prefix-summering och vilket problem l√∂ser den?

Lista fyra kommandon du anv√§nder f√∂rst n√§r routing ‚Äúinte funkar‚Äù.

### 

### üîó F√∂rdjupningsl√§nkar

- https://www.rfc-editor.org/rfc/rfc2453 (RIP v2)
- https://www.rfc-editor.org/rfc/rfc2328 (OSPFv2)
- https://www.rfc-editor.org/rfc/rfc5798 (VRRPv3)
- https://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/7039-1.html
- https://www.juniper.net/documentation/us/en/software/junos/routing-policy/topics/concept/policy-basics.html

https://www.rfc-editor.org/rfc/rfc2453 (RIP v2)

https://www.rfc-editor.org/rfc/rfc2328 (OSPFv2)

https://www.rfc-editor.org/rfc/rfc5798 (VRRPv3)

https://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/7039-1.html

https://www.juniper.net/documentation/us/en/software/junos/routing-policy/topics/concept/policy-basics.html

### 

### ‚úçÔ∏è Egna anteckningar

‚Ä¶


