# 5. F√∂rdjupningsdel

## 5.1 Virtualisering ‚Äì plattformar och gemensamma m√∂nster

### 5.1.1 Varf√∂r virtualisera? (problembakgrund och m√•l)

Virtualisering blev standard d√§rf√∂r att den l√∂ser flera problem samtidigt: h√•rdvaran utnyttjas b√§ttre (fler servrar per fysisk v√§rd), isolation mellan tj√§nster √∂kar drifts√§kerheten, snabb √•terst√§llning blir m√∂jlig med snapshots/kloner/backup, och automation (skript, mallar, ‚Äúinfrastruktur som kod‚Äù) g√∂r att du kan bygga och √•terskapa milj√∂er p√• minuter ist√§llet f√∂r dagar. F√∂r skola och SMB betyder det att labbar och skarp drift kan leva sida vid sida, att uppgraderingar testas innan de rullas ut, och att enskilda fel inte beh√∂ver ta ner hela milj√∂n. Virtualisering f√∂renklar ocks√• disaster recovery ‚Äì n√§r servrar √§r filer/diskavbilder kan de flyttas och startas p√• annan h√•rdvara.

Vanliga drivkrafter: konsolidering och kostnad, snabb provisionering, enklare DR/backup, b√§ttre s√§kerhetszonering, samt m√∂jligheten att skala och √§ndra utan att byta fysisk h√•rdvara varje g√•ng.

Exempel (Exempel:*) Inf√∂r nationella prov k√∂rs en separat provtj√§nst i egen VM. Efter provperioden tas en snapshot f√∂r arkiv, och resurserna (CPU/RAM) √•terg√•r till ordinarie drift.

### 5.1.2 Gemensam arkitektur (oavsett plattform)

Alla moderna plattformar delar samma byggstenar: hypervisor (k√§rnan som k√∂r VM:er), virtuella switchar/bridges som kopplar VM:er mot n√§tet, lagring (lokal eller delad), och hantering (webb-UI/CLI/API). Du arbetar med mallar (golden images), n√§tprofiler (VLAN/portgrupper), samt policies f√∂r resurser och s√§kerhet. Tv√• viktiga principer:

- Snapshots ‚â† backup (snapshot √§r kortlivad s√§kerhetslina; backup √§r separata, helst immutabla/air-gappade kopior).
- Segmentera trafik: management, lagring, backup och produktion i egna VLAN/subn√§t och med tydliga brandv√§ggsregler.

Snapshots ‚â† backup (snapshot √§r kortlivad s√§kerhetslina; backup √§r separata, helst immutabla/air-gappade kopior).

Segmentera trafik: management, lagring, backup och produktion i egna VLAN/subn√§t och med tydliga brandv√§ggsregler.

Exempel (Exempel:*) Management-VLAN n√•s bara via bastion/jump host; backupfl√∂den g√•r i separat VLAN s√• att en √∂verbelastad applikationsl√§nk inte st√∂r backupf√∂nstret.

### 5.1.3 Plattformerna (bakgrund, styrkor och begr√§nsningar)

Proxmox VE (KVM/QEMU + LXC, Debianbaserad)
Proxmox bygger p√• Debian Linux och anv√§nder KVM/QEMU f√∂r fullvirtualisering (bra f√∂r Windows Server) samt LXC f√∂r l√§tta Linux-containrar. Styrkorna √§r √∂ppen k√§llkod, snabb utveckling, VLAN-aware Linux bridges, ZFS-st√∂d, klusterhantering och Proxmox Backup Server (dedupe, verifiering, immutability-policy). Passar skolor/labbar/SMB som vill ha kraftfullt och kostnadseffektivt utan licensl√•sning. Begr√§nsningar: kr√§ver Linux-vana, f√§rre ‚Äúf√§rdigpaketerade‚Äù enterprise-ekosystem √§n vSphere.

VMware vSphere/ESXi (propriet√§r standard i m√•nga f√∂retag)
vSphere best√•r av ESXi (hypervisor) och vCenter (central hantering). Styrkorna √§r mogen drift, enormt ekosystem (backup, √∂vervakning), vMotion/DRS (liveflytt/lastbalansering) och Distributed vSwitch. L√§mpligt n√§r du beh√∂ver bepr√∂vad, stor skala och certifierat st√∂d fr√•n m√•nga leverant√∂rer. Begr√§nsningar: licenskostnad, beroende av VMware-ekosystemet; avancerade funktioner kr√§ver r√§tt edition.

Microsoft Hyper-V (Windowsintegrerad hypervisor)
Hyper-V √§r integrerad i Windows Server (roll) och har virtual switch, VHDX, Checkpoints och bra PowerShell-st√∂d. Styrkor: tajt integration med Windows, AD/GPO, SMB3/Storage Spaces, och gott st√∂d i m√•nga backupverktyg. L√§mpligt om ni redan √§r ‚ÄúWindows-tunga‚Äù och vill h√•lla verktygen enhetliga. Begr√§nsningar: mindre ekosystem f√∂r Linux-containers, vissa funktioner kr√§ver Datacenter-licens; Microsofts frist√•ende Hyper-V Server √§r utfasad (fokuset ligger p√• Windows Server-rollen).

XCP-ng (Xen-baserad, √∂ppen)
XCP-ng bygger p√• Xen och erbjuder enterprise-k√§nsla i open-source-tappning, med Xen Orchestra f√∂r hantering/backup (GUI/SaaS eller self-hosted). Styrkor: bra balans mellan enkelhet och kapacitet, stabil hypervisor, vettiga snapshot/backupfl√∂den, och aktiv community. Begr√§nsningar: f√§rre ‚Äúplug-and-play‚Äù-integrationer √§n VMware, viss inl√§rningskurva kring Xen-terminologi.

libvirt/KVM ‚Äúren‚Äù (t.ex. virt-manager/terraform-libvirt)
Det ‚Äúrena‚Äù KVM/libvirt-sp√•ret ger maximal kontroll (n√§ra Linux), med bridge/OVS, cloud-init, och automation via Ansible/Terraform. Styrkor: full transparens, inga licenser, perfekt f√∂r djup Linuxlabb. Begr√§nsningar: kr√§ver mest Linux-kompetens; f√§rre bekv√§mligheter out-of-the-box f√∂r st√∂rre team.

Exempel (Exempel:*) En kommunal IT-avdelning med Windows-tyngd k√∂r Hyper-V f√∂r skarp drift (AD, fil, print) men anv√§nder Proxmox f√∂r kurslabb och snabb prototypning. En partner k√∂r vSphere f√∂r ‚Äútunga‚Äù produktionstj√§nster med h√∂ga SLA, och XCP-ng p√• filialkontor.

### 5.1.4 N√§tm√∂nster: bridge, trunk, VLAN och NAT

Oavsett plattform m√∂ter du tre m√∂nster:
Bridge till produktion (VLAN-aware): uplink som trunk fr√•n switchen; skapa portgrupp/bridge som b√§r flera VLAN och tilldela VLAN-ID per VM-interface.
Isolerat NAT-n√§t f√∂r labb: en virtuell switch/bridge med NAT mot v√§rden eller s√§rskild edge-VM; perfekt f√∂r att l√•ta elever labba utan att r√∂ra produktion.
Dedikerad management/backup/storage-v√§g: separata n√§t f√∂r admin, backup och lagring (t.ex. iSCSI/NFS) f√∂r prestanda/s√§kerhet.

Exempel (Exempel:*) En webb-VM i DMZ f√•r vNIC p√• VLAN 70; brandv√§gg sl√§pper endast 80/443 in och 443 till intern API-server. En andra vNIC p√• VLAN 99 anv√§nds enbart f√∂r backupfl√∂den till backupservern.

### 5.1.5 Lagring, snapshots och backup

Snapshots fryser VM-disk (och ev. minne) p√• prim√§r lagring; de √§r perfekta inf√∂r √§ndringar men ska rensas efter test. Backup skapar en separerad kopia (helst immutabel och/eller air-gappad) som inte p√•verkas om prim√§r lagring skadas eller krypteras.
Proxmox + Proxmox Backup Server ger dedupe/komprimering/verifiering. vSphere har stort st√∂d i verktyg som Veeam. Hyper-V fungerar med VSS och Windows-/tredjepartsbackup. XCP-ng har XO/XOA-backup. Libvirt/KVM kan anv√§nda borg/restic/rsync-strategier och ‚Äúagent-i-g√§st‚Äù f√∂r app-konsistens.

Exempel (Exempel:*) Inf√∂r patch: snapshot ‚Üí patch ‚Üí test ‚Üí rensa snapshot; ordinarie nattbackup (full + inkrementell) forts√§tter och restore-test k√∂rs varje m√•nad i isolerat VLAN.

### 5.1.6 H√∂g tillg√§nglighet, kluster och DR

Kluster l√•ter dig hantera flera noder som en enhet (gemensam vy, policyer). Live migration flyttar VM utan avbrott vid underh√•ll. HA startar automatiskt om VM:er p√• annan nod vid fel. F√∂r DR (st√∂rre avbrott) beh√∂vs replikerad backup, dokumenterad √•terstartsordning (Tier 0‚Üí1‚Üí2) och regelbundna sp√§rrtester (se kapitel 4.4).

Exempel: Kv√§llsunderh√•ll: vMotion/Live Migration flyttar VM bort fr√•n noden som ska patchas. Under driftfel startar HA upp kritiska VM p√• frisk nod; anv√§ndarna m√§rker en kort paus.

### 5.1.7 Resurser och licenser (CPU, RAM, disk, Windows Server)

Allokera resurser konservativt f√∂rst och m√§t. Overcommit kan fungera f√∂r CPU men var f√∂rsiktig med RAM och I/O-tunga diskar. Planera n√§tprofiler (vNIC-antal/roller) och h√•ll dig till namngivning/mallar f√∂r sp√•rbarhet.
T√§nk √§ven p√• licenser: Windows Server Datacenter ger r√§tt att k√∂ra obegr√§nsat antal Windows-VM:er p√• licensierad h√•rdvara; Standard ger r√§tt f√∂r ett mindre antal VM:er per licens. Detta kan styra var du placerar Windows-tunga arbetslaster.

Exempel: Filserver-VM: 2 vCPU, 8‚Äì12 GB RAM (6‚Äì8 GB garanterat), virtio-SCSI + iothread, tv√• vNIC (produktion/backup). Justera efter m√§tv√§rden i √∂vervakningen.

### 5.1.8 S√§kerhet och driftetikett

Separera management fr√•n produktion, anv√§nd MFA och bastion/jump host f√∂r admin√•tkomst, och logga alla f√∂r√§ndringar. H√•ll brandv√§ggspolicy mellan VLAN/zoner √§ven i labb. Vid WLAN-anslutna klienter som n√•r VM-milj√∂n: s√§kerst√§ll rollbaserade brandv√§ggsregler och √∂vervaka ovanliga fl√∂den.

Exempel: Admin n√•r hypervisorer via VPN ‚Üí bastion i management-VLAN ‚Üí SSH/RDP vidare till v√§rdar/VM. Inga √∂ppna adminportar mot internet.

### 

### 5.1.9 J√§mf√∂relsetabell (styrkor, n√§r anv√§nda, begr√§nsningar)

Proxmox (Debian)

- N√§tmodell (VLAN/NAT): Linux bridge (VLAN-aware), trunk p√• uplink, NAT-bridge f√∂r labb, bond/LACP.
- HA/Live migration: Kluster med Proxmox HA; live migration (delad lagring eller replikering).
- Backup-ekosystem: Proxmox Backup Server (dedupe, verifiering, immutability-policy) + 3:e-partsverktyg via standardprotokoll.
- Styrkor: √ñppen k√§llkod, kostnadseffektiv, LXC + KVM, ZFS-st√∂d, starkt API/community.
- Begr√§nsningar: Kr√§ver mer Linuxvana; f√§rre ‚Äústora‚Äù certifierade integrationer √§n vSphere.
- L√§mplighet: Skola/SMB/labb; mixad Win/Linux; d√§r budget, flexibilitet och transparens v√§ger tungt.

N√§tmodell (VLAN/NAT): Linux bridge (VLAN-aware), trunk p√• uplink, NAT-bridge f√∂r labb, bond/LACP.

HA/Live migration: Kluster med Proxmox HA; live migration (delad lagring eller replikering).

Backup-ekosystem: Proxmox Backup Server (dedupe, verifiering, immutability-policy) + 3:e-partsverktyg via standardprotokoll.

Styrkor: √ñppen k√§llkod, kostnadseffektiv, LXC + KVM, ZFS-st√∂d, starkt API/community.

Begr√§nsningar: Kr√§ver mer Linuxvana; f√§rre ‚Äústora‚Äù certifierade integrationer √§n vSphere.

L√§mplighet: Skola/SMB/labb; mixad Win/Linux; d√§r budget, flexibilitet och transparens v√§ger tungt.

VMware vSphere/ESXi

- N√§tmodell (VLAN/NAT): vSwitch/Distributed vSwitch, port groups (VLAN-ID), NAT via Edge-/gateway-VM eller NSX.
- HA/Live migration: Mycket moget: vMotion/Storage vMotion/DRS/HA.
- Backup-ekosystem: Stort (VADP-st√∂d); Veeam m.fl. med bred funktionalitet.
- Styrkor: Mognad, skala, brett ekosystem, leverant√∂rsst√∂d/certifieringar.
- Begr√§nsningar: Licenskostnader och editioner; viss inl√•sning i ekosystemet.
- L√§mplighet: St√∂rre/kritiska milj√∂er med h√•rda SLA och krav p√• certifierade integrationer.

N√§tmodell (VLAN/NAT): vSwitch/Distributed vSwitch, port groups (VLAN-ID), NAT via Edge-/gateway-VM eller NSX.

HA/Live migration: Mycket moget: vMotion/Storage vMotion/DRS/HA.

Backup-ekosystem: Stort (VADP-st√∂d); Veeam m.fl. med bred funktionalitet.

Styrkor: Mognad, skala, brett ekosystem, leverant√∂rsst√∂d/certifieringar.

Begr√§nsningar: Licenskostnader och editioner; viss inl√•sning i ekosystemet.

L√§mplighet: St√∂rre/kritiska milj√∂er med h√•rda SLA och krav p√• certifierade integrationer.

Microsoft Hyper-V (Windows)

- N√§tmodell (VLAN/NAT): Virtual Switch med VLAN-ID, NIC Teaming; NAT via RRAS/Windows NAT eller gateway-VM.
- HA/Live migration: Failover Clustering, Live/Storage Migration.
- Backup-ekosystem: VSS-integration; Windows Server Backup, Veeam m.fl.
- Styrkor: Tajt Windows/AD-integration, PowerShell/automation, l√•g tr√∂skel i MS-milj√∂.
- Begr√§nsningar: Vissa funktioner kr√§ver Datacenter-licens; mindre fokus p√• Linux/containers; frist√•ende Hyper-V Server utfasad.
- L√§mplighet: Windows-tung drift (AD, fil/print, RDS); skolor/organisationer med MS-stack.

N√§tmodell (VLAN/NAT): Virtual Switch med VLAN-ID, NIC Teaming; NAT via RRAS/Windows NAT eller gateway-VM.

HA/Live migration: Failover Clustering, Live/Storage Migration.

Backup-ekosystem: VSS-integration; Windows Server Backup, Veeam m.fl.

Styrkor: Tajt Windows/AD-integration, PowerShell/automation, l√•g tr√∂skel i MS-milj√∂.

Begr√§nsningar: Vissa funktioner kr√§ver Datacenter-licens; mindre fokus p√• Linux/containers; frist√•ende Hyper-V Server utfasad.

L√§mplighet: Windows-tung drift (AD, fil/print, RDS); skolor/organisationer med MS-stack.

XCP-ng (Xen)

- N√§tmodell (VLAN/NAT): Networks med VLAN-taggning; NAT via gateway-VM (t.ex. OPNsense).
- HA/Live migration: Live migration/HA med delad lagring; orkestreras via Xen Orchestra (XO/XOA).
- Backup-ekosystem: Inbyggt i XO/XOA (delta, replikering) + 3:e-partsverktyg.
- Styrkor: Open source med ‚Äúenterprise-k√§nsla‚Äù, enkel drift, bra GUI (XO).
- Begr√§nsningar: Mindre ekosystem √§n VMware; vissa features beroende av XO.
- L√§mplighet: Filial/SMB; behov av HA/backup utan stora licenskostnader.

N√§tmodell (VLAN/NAT): Networks med VLAN-taggning; NAT via gateway-VM (t.ex. OPNsense).

HA/Live migration: Live migration/HA med delad lagring; orkestreras via Xen Orchestra (XO/XOA).

Backup-ekosystem: Inbyggt i XO/XOA (delta, replikering) + 3:e-partsverktyg.

Styrkor: Open source med ‚Äúenterprise-k√§nsla‚Äù, enkel drift, bra GUI (XO).

Begr√§nsningar: Mindre ekosystem √§n VMware; vissa features beroende av XO.

L√§mplighet: Filial/SMB; behov av HA/backup utan stora licenskostnader.

libvirt/KVM ‚Äúren‚Äù

- N√§tmodell (VLAN/NAT): Linux bridge/OVS, trunking; NAT via virbr0/dnsmasq eller egen brandv√§gg.
- HA/Live migration: M√∂jligt (Pacemaker/Corosync/virt-tools), men mer ‚Äúbygg sj√§lv‚Äù.
- Backup-ekosystem: DIY: borg/restic/rsync + qemu-img/virsh; app-konsistens via agenter/skript.
- Styrkor: Maximal kontroll, inga licenser, ideal f√∂r automation/DevOps/labb.
- Begr√§nsningar: Mest handp√•l√§ggning och Linuxkompetens; f√§rre bekv√§mligheter f√∂r st√∂rre team.
- L√§mplighet: Labb/utbildning, CI/CD, speciall√∂sningar d√§r full kontroll prioriteras.

N√§tmodell (VLAN/NAT): Linux bridge/OVS, trunking; NAT via virbr0/dnsmasq eller egen brandv√§gg.

HA/Live migration: M√∂jligt (Pacemaker/Corosync/virt-tools), men mer ‚Äúbygg sj√§lv‚Äù.

Backup-ekosystem: DIY: borg/restic/rsync + qemu-img/virsh; app-konsistens via agenter/skript.

Styrkor: Maximal kontroll, inga licenser, ideal f√∂r automation/DevOps/labb.

Begr√§nsningar: Mest handp√•l√§ggning och Linuxkompetens; f√§rre bekv√§mligheter f√∂r st√∂rre team.

L√§mplighet: Labb/utbildning, CI/CD, speciall√∂sningar d√§r full kontroll prioriteras.

### 5.1.10 Snabba ‚Äúrecept‚Äù per plattform

Proxmox (Debian-bas):
VM p√• r√§tt VLAN: Trunka uplink, s√§tt vmbr0 VLAN-aware, ge vNIC VLAN-tagg.
NAT-labb: Skapa vmbrN med NAT; l√§gg kurs-VM:er d√§r.
Snapshot + rollback: Snapshot ‚Üí √§ndra ‚Üí testa ‚Üí rensa.
Enklast backup: PBS-target, daglig inkrementell + m√•natlig verifiering.

VMware vSphere/ESXi:
VM p√• r√§tt VLAN: Skapa port group med VLAN-ID, koppla vNIC dit.
NAT-labb: Anv√§nd Edge-VM (pfSense/OPNsense) eller NSX-Edge f√∂r NAT.
Snapshot + rollback: Snapshot via vCenter; rensa efter test.
Enklast backup: Veeam-jobb mot vCenter, GFS-retention, regelbunden restore-test.

Hyper-V (Windows):
VM p√• r√§tt VLAN: Virtual Switch + VLAN-ID p√• vNIC.
NAT-labb: Intern switch + Routing/NAT-roll i en liten gateway-VM.
Checkpoint + rollback: Checkpoint f√∂re √§ndring; ‚ÄúApply‚Äù/Delete n√§r klar.
Enklast backup: Windows Server Backup eller Veeam med VSS-konsistens.

XCP-ng:
VM p√• r√§tt VLAN: Skapa network med VLAN-tagg, koppla vNIC.
NAT-labb: Gateway-VM f√∂r NAT (t.ex. OPNsense).
Snapshot + rollback: Via XO/XOA, rensa n√§r klart.
Enklast backup: XO-backup (delta), regelbunden verifiering.

libvirt/KVM:
VM p√• r√§tt VLAN: Linux bridge/OVS + trunk uthamnad; vNIC med VLAN-tagg.
NAT-labb: virbr0 (default NAT) eller egen dnsmasq/firewalld-NAT.
Snapshot + rollback: qemu-img/virsh snapshot.
Enklast backup: stoppa-konsistens + rsync/borg/restic; f√∂r app-konsistens anv√§nd agent/scripting.

### 

### üìå Kontrollfr√•gor

- Ge tre sk√§l till att virtualisera som direkt p√•verkar tillg√§nglighet och arbetstakt.
- F√∂rklara skillnaden mellan snapshot och backup och n√§r respektive anv√§nds.
- Varf√∂r b√∂r management, lagring, backup och produktion separeras n√§tm√§ssigt?
- N√§r v√§ljer du Proxmox framf√∂r vSphere ‚Äì och tv√§rtom?
- Vad talar f√∂r Hyper-V i en Windows-tung skolmilj√∂?
- Hur s√§tter du en VM p√• r√§tt VLAN i vSphere, Hyper-V respektive Proxmox (kort steg f√∂r steg)?
- Vad inneb√§r overcommit och vilka risker finns f√∂r RAM och I/O?
- N√§mn tv√• s√§tt att skapa ett isolerat NAT-labb utan att p√•verka produktion.
- Vilka komponenter beh√∂vs f√∂r HA + live migration i praktiken?
- Hur skulle du licensiera Windows-tunga VM-v√§rdar kostnadseffektivt (Standard vs Datacenter)?

Ge tre sk√§l till att virtualisera som direkt p√•verkar tillg√§nglighet och arbetstakt.

F√∂rklara skillnaden mellan snapshot och backup och n√§r respektive anv√§nds.

Varf√∂r b√∂r management, lagring, backup och produktion separeras n√§tm√§ssigt?

N√§r v√§ljer du Proxmox framf√∂r vSphere ‚Äì och tv√§rtom?

Vad talar f√∂r Hyper-V i en Windows-tung skolmilj√∂?

Hur s√§tter du en VM p√• r√§tt VLAN i vSphere, Hyper-V respektive Proxmox (kort steg f√∂r steg)?

Vad inneb√§r overcommit och vilka risker finns f√∂r RAM och I/O?

N√§mn tv√• s√§tt att skapa ett isolerat NAT-labb utan att p√•verka produktion.

Vilka komponenter beh√∂vs f√∂r HA + live migration i praktiken?

Hur skulle du licensiera Windows-tunga VM-v√§rdar kostnadseffektivt (Standard vs Datacenter)?

### 

### üîó F√∂rdjupningsl√§nkar

- Proxmox VE docs: https://pve.proxmox.com/pve-docs/
- VMware vSphere docs: https://docs.vmware.com/
- Microsoft Hyper-V docs: https://learn.microsoft.com/windows-server/virtualization/hyper-v/
- XCP-ng & XO: https://xcp-ng.org/ och https://xen-orchestra.com/
- libvirt/KVM: https://libvirt.org/ och https://qemu.readthedocs.io/
- Linux bridge/OVS grunder: https://wiki.linuxfoundation.org/networking/bridge

Proxmox VE docs: https://pve.proxmox.com/pve-docs/

VMware vSphere docs: https://docs.vmware.com/

Microsoft Hyper-V docs: https://learn.microsoft.com/windows-server/virtualization/hyper-v/

XCP-ng & XO: https://xcp-ng.org/ och https://xen-orchestra.com/

libvirt/KVM: https://libvirt.org/ och https://qemu.readthedocs.io/

Linux bridge/OVS grunder: https://wiki.linuxfoundation.org/networking/bridge

### 

### ‚úçÔ∏è Egna anteckningar

‚Ä¶


