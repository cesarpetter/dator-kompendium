# Kapitel 1 ‚Äì Vad √§r ett n√§tverk?

## 2.2 VLAN och segmentering

### 2.2.1 Varf√∂r segmentera n√§t?

Segmentering delar upp n√§tverket i mindre, separata dom√§ner s√• att broadcasttrafik, fel och attacker inte sprids fritt. Det g√∂r n√§tet effektivare, s√§krare och l√§ttare att fels√∂ka. I praktiken g√∂rs segmentering oftast med VLAN (Virtual LAN), och kompletteras med brandv√§ggspolicys mellan segmenten.

I ett ofragmenterat n√§t hamnar alla klienter i samma broadcastdom√§n ‚Äì en felkonfigurerad klient eller infekterad enhet kan d√• p√•verka alla andra.

F√∂rtydligande:

- Prestanda: mindre broadcastdom√§ner minskar on√∂dig trafik.
- S√§kerhet: begr√§nsar lateral f√∂rflyttning; policys mellan VLAN.
- Fels√∂kning: tydligare gr√§nser g√∂r orsaker l√§ttare att ringa in.

Prestanda: mindre broadcastdom√§ner minskar on√∂dig trafik.

S√§kerhet: begr√§nsar lateral f√∂rflyttning; policys mellan VLAN.

Fels√∂kning: tydligare gr√§nser g√∂r orsaker l√§ttare att ringa in.

Exempel: Separera ‚ÄúPersonal‚Äù, ‚ÄúElev‚Äù, ‚ÄúG√§st‚Äù, ‚ÄúServrar‚Äù och ‚ÄúManagement‚Äù i egna VLAN. Till√•t endast definierade fl√∂den mellan dem.

### 2.2.2 VLAN-grunder: 802.1Q, access och trunk

Ett VLAN √§r en logisk indelning av ett fysiskt n√§t. P√• switchportar skiljer vi mellan accessportar (tillh√∂r ett enda VLAN) och trunkar (b√§r flera VLAN samtidigt). P√• trunkar m√§rks ramar med 802.1Q-taggar som anger VLAN-ID (1‚Äì4094).

I vissa fabrikat finns ett f√∂rhandlingsprotokoll f√∂r trunkning, Dynamic Trunking Protocol (DTP). DTP f√∂rs√∂ker automatiskt komma √∂verens med mot√§nden om att g√∂ra en port till trunk. I en s√§ker och f√∂ruts√§gbar design st√§nger man av DTP och s√§tter portl√§get explicit (access eller trunk), f√∂r att undvika oavsiktlig trunkning.

F√∂rtydligande:

- Accessport: o-taggad trafik; en klient/port h√∂r till exakt ett VLAN.
- Trunk: taggad trafik f√∂r flera VLAN mellan switchar/routrar/AP.
- Native VLAN: o-taggad trafik p√• en trunk; h√•ll det oanv√§nt/avskilt f√∂r att minska risk.

Accessport: o-taggad trafik; en klient/port h√∂r till exakt ett VLAN.

Trunk: taggad trafik f√∂r flera VLAN mellan switchar/routrar/AP.

Native VLAN: o-taggad trafik p√• en trunk; h√•ll det oanv√§nt/avskilt f√∂r att minska risk.

ISL √§r legacy och anv√§nds inte i modern design ‚Äì 802.1Q √§r praxis.

Exempel: SW1‚ÄìSW2 √§r ihopkopplade med en trunk som b√§r VLAN 10/20/30/40. En skrivare p√• port 12 √§r access i VLAN 20.

### 2.2.3 Inter-VLAN-routing: L3-switch eller ‚Äúrouter-on-a-stick‚Äù

Eftersom VLAN √§r separata beh√∂vs routing f√∂r att de ska kunna n√• varandra. Det l√∂ses antingen i en L3-switch via SVI (Switch Virtual Interface) eller med en router/brandv√§gg via en trunk (‚Äúrouter-on-a-stick‚Äù).

F√∂rtydligande:

- SVI: ett virtuellt interface per VLAN (gateway-adress), h√∂g prestanda i switch.
- Router/brandv√§gg: en subinterface per VLAN; bra n√§r policys ska centreras.
- Placering: v√§lj d√§r du enklast kan till√§mpa policy och skala.

SVI: ett virtuellt interface per VLAN (gateway-adress), h√∂g prestanda i switch.

Router/brandv√§gg: en subinterface per VLAN; bra n√§r policys ska centreras.

Placering: v√§lj d√§r du enklast kan till√§mpa policy och skala.

Exempel: SVI VLAN 20 = 10.20.0.1 fungerar som gateway f√∂r elever. Brandv√§ggen har policy som till√•ter VLAN 20 ‚Üí internet, men blockerar VLAN 20 ‚Üí Servrar (VLAN 40).

### 2.2.4 Designm√∂nster: vanliga VLAN och betalager

I skolor och campus √•terkommer n√•gra m√∂nster. Separera funktioner och riskprofiler ‚Äì och l√§gg r√§tt brandv√§ggspolicys mellan dem.

Vanliga segment (f√∂rtydligande):

- Personal (VLAN 10): √•tkomst till AD, fil och interna system.
- Elev (VLAN 20): begr√§nsad √•tkomst; inga administrativa resurser.
- G√§st (VLAN 30): endast internet; isolerade klienter.
- Servrar (VLAN 40): AD/DNS/fil/DHCP, skyddat.
- WLAN-AP (VLAN 50): hanterings- och tunnlingtrafik; separera fr√•n klient-VLAN.
- Voice (VLAN 60): IP-telefoni med QoS (DSCP/802.1p).
- Management (VLAN 99 t.ex.): endast f√∂r admin via VPN/arbetsstationer.

Personal (VLAN 10): √•tkomst till AD, fil och interna system.

Elev (VLAN 20): begr√§nsad √•tkomst; inga administrativa resurser.

G√§st (VLAN 30): endast internet; isolerade klienter.

Servrar (VLAN 40): AD/DNS/fil/DHCP, skyddat.

WLAN-AP (VLAN 50): hanterings- och tunnlingtrafik; separera fr√•n klient-VLAN.

Voice (VLAN 60): IP-telefoni med QoS (DSCP/802.1p).

Management (VLAN 99 t.ex.): endast f√∂r admin via VPN/arbetsstationer.

Voice VLAN kan prioriteras i switch (trust boundary n√§ra telefonen). G√§stn√§t b√∂r ha h√•rda egress-regler och klientisolering (AP/brandv√§gg).

### 2.2.5 Lager-2-skydd: ‚Äúh√•rda portar‚Äù och kontroll av giftig trafik

F√∂r att segmenteringen ska h√•lla beh√∂ver accesslagret f√∂rst√§rkas med lager-2-skydd. H√§r spelar tv√• byggstenar stor roll:
Bridge Protocol Data Unit (BPDU) och Spanning Tree Protocol (STP). En BPDU √§r ett kontrollmeddelande som switchar skickar till varandra f√∂r att dela topologi-information. STP anv√§nder BPDUs f√∂r att uppt√§cka loopar och best√§mma vilka l√§nkar som ska vara aktiva respektive blockerade.

Med detta i ryggen l√•ser vi portl√§gen, validerar kontrolltrafik och stoppar vanliga attacker.

Skydd (f√∂rtydligande):

- St√§ng DTP/auto trunk: s√§tt accessportar fixed access; till√•t trunk endast d√§r du beh√∂ver den.
- Port Security: begr√§nsa antal MAC/adresser per port; l√§r in/‚Äùsticky‚Äù vid behov.
- BPDU Guard/Root Guard: st√§ng port som tar emot ov√§ntade BPDUs (BPDU Guard) och hindra o√∂nskad root-f√∂rskjutning (Root Guard).
- DHCP Snooping: lita endast p√• legitima DHCP-servrar.
- Dynamic ARP Inspection (DAI): stoppa ARP-spoofing (kr√§ver DHCP Snooping).
- IP Source Guard: blockera falska k√§ll-IP p√• accessportar.
- Storm Control: stryp broadcast/multicast vid fel.

St√§ng DTP/auto trunk: s√§tt accessportar fixed access; till√•t trunk endast d√§r du beh√∂ver den.

Port Security: begr√§nsa antal MAC/adresser per port; l√§r in/‚Äùsticky‚Äù vid behov.

BPDU Guard/Root Guard: st√§ng port som tar emot ov√§ntade BPDUs (BPDU Guard) och hindra o√∂nskad root-f√∂rskjutning (Root Guard).

DHCP Snooping: lita endast p√• legitima DHCP-servrar.

Dynamic ARP Inspection (DAI): stoppa ARP-spoofing (kr√§ver DHCP Snooping).

IP Source Guard: blockera falska k√§ll-IP p√• accessportar.

Storm Control: stryp broadcast/multicast vid fel.

Exempel: En elev kopplar in en liten ‚Äúsmart-switch‚Äù som b√∂rjar skicka BPDU ‚Äì med BPDU Guard sl√•r porten ifr√•n och resten av n√§tet p√•verkas inte.

### 2.2.6 VLAN i WLAN: SSID ‚Üí VLAN och g√§stisolering

I tr√•dl√∂sa n√§t mappas SSID till VLAN. Det g√∂r att samma s√§kerhets- och segmenteringsmodell g√§ller oavsett medium. G√§ster f√•r eget SSID och eget VLAN, ofta med klient-till-klient-blockering p√• AP och strikta brandv√§ggsregler.

F√∂rtydligande:

- F√• SSID: 2‚Äì4 v√§l valda, mappa till r√§tt VLAN.
- Personliga/k√§nsliga n√§t: 802.1X/Enterprise; unika identiteter.
- G√§st: Captive portal om behov; internet-only; rate limit och egress-filter.

F√• SSID: 2‚Äì4 v√§l valda, mappa till r√§tt VLAN.

Personliga/k√§nsliga n√§t: 802.1X/Enterprise; unika identiteter.

G√§st: Captive portal om behov; internet-only; rate limit och egress-filter.

Exempel: Elev-SSID ‚Üí VLAN 20, Personal-SSID ‚Üí VLAN 10, G√§st-SSID ‚Üí VLAN 30. G√§st isoleras klient-vis och f√•r bara TCP/UDP ut mot internet.

### 2.2.7 STP, RSTP och MSTP i redundanta VLAN-milj√∂er

Spanning Tree Protocol (STP) √§r ett loopskydd som automatiskt blockerar √∂verfl√∂diga v√§gar i lager-2-n√§t s√• att en tr√§dstruktur skapas. Rapid STP (RSTP) √§r en f√∂rb√§ttrad variant med snabbare konvergens vid fel (typiskt millisekunder‚Äìsekunder snarare √§n m√•nga sekunder). N√§r n√§tet inneh√•ller m√•nga VLAN √§r Multiple STP (MSTP) anv√§ndbart: du grupperar VLAN i instanser och kan l√•ta olika instanser ha olika ‚Äúroot‚Äù och l√§nkval, vilket b√•de balanserar last och f√∂renklar drift.

I alla fall √§r det viktigt att tydligt placera root-bridge (oftast i distribution/core), trimma vilka VLAN som alls f√•r g√• p√• en trunk (pruning) och se till att trunkarnas allowed-listor matchar i b√•da √§ndar. Native VLAN ska vara konsekvent konfigurerat och helst inte anv√§ndas f√∂r produktionstrafik.

F√∂rtydligande:

- STP: grundl√§ggande loopskydd.
- RSTP: snabbare √•terh√§mtning.
- MSTP: grupperar VLAN i instanser f√∂r lastbalans och enklare hantering.
- Root-kontroll: l√•s root till avsedd plats (distribution/core).

STP: grundl√§ggande loopskydd.

RSTP: snabbare √•terh√§mtning.

MSTP: grupperar VLAN i instanser f√∂r lastbalans och enklare hantering.

Root-kontroll: l√•s root till avsedd plats (distribution/core).

### 2.2.8 Dokumentation och fels√∂kning

Bra dokumentation √§r din snabbaste fels√∂kningsresurs. F√∂r varje VLAN: ID, namn, subn√§t/prefix, gateway (SVI), DHCP-scope, DNS-policy, brandv√§ggspolicys, trunk-rutter och till√•tna portar. Vid felkontroll: b√∂rja i access (l√§nk, port-mode, r√§tt VLAN) och r√∂r dig upp√•t.

Check vid fel (f√∂rtydligande):

- Portl√§ge: access/trunk korrekt? r√§tt VLAN?
- Trunk: allowed VLANs lika i b√•da √§ndar? native lika?
- SVI: up/up? r√§tt IP/mask?
- DHCP/DNS: f√•r klient leas? svarar DNS?
- STP: blockad l√§nk d√§r du v√§ntar dig? root d√§r du planerat?
- Tabeller: MAC/ARP i r√§tt segment?

Portl√§ge: access/trunk korrekt? r√§tt VLAN?

Trunk: allowed VLANs lika i b√•da √§ndar? native lika?

SVI: up/up? r√§tt IP/mask?

DHCP/DNS: f√•r klient leas? svarar DNS?

STP: blockad l√§nk d√§r du v√§ntar dig? root d√§r du planerat?

Tabeller: MAC/ARP i r√§tt segment?

Exempel: Klient i Personal n√•r inte filservern: porten var access i VLAN 20 (Elev) i st√§llet f√∂r VLAN 10 ‚Äì √§ndra och problemet f√∂rsvinner.

### 

### üìå Kontrollfr√•gor

- Vilka tre huvudsakliga sk√§l finns f√∂r att segmentera n√§tet med VLAN?
- F√∂rklara skillnaden mellan accessport och trunk samt vad 802.1Q g√∂r.
- Vad √§r DTP och varf√∂r b√∂r det st√§ngas av i en s√§ker design?
- Vad √§r en BPDU och hur anv√§nder STP den?
- N√§r v√§ljer du SVI/L3-switch j√§mf√∂rt med ‚Äúrouter-on-a-stick‚Äù?
- Ge exempel p√• fem vanliga VLAN i en skolmilj√∂ och deras syfte.
- Vad √§r ‚Äúnative VLAN‚Äù och hur b√∂r det hanteras?
- N√§mn fyra lager-2-skydd du b√∂r aktivera i accesslagret och deras syfte.
- Beskriv skillnaden mellan STP, RSTP och MSTP och n√§r MSTP hj√§lper.
- Lista fem saker du alltid kontrollerar n√§r en klient ‚Äúhamnat i fel n√§t‚Äù.

Vilka tre huvudsakliga sk√§l finns f√∂r att segmentera n√§tet med VLAN?

F√∂rklara skillnaden mellan accessport och trunk samt vad 802.1Q g√∂r.

Vad √§r DTP och varf√∂r b√∂r det st√§ngas av i en s√§ker design?

Vad √§r en BPDU och hur anv√§nder STP den?

N√§r v√§ljer du SVI/L3-switch j√§mf√∂rt med ‚Äúrouter-on-a-stick‚Äù?

Ge exempel p√• fem vanliga VLAN i en skolmilj√∂ och deras syfte.

Vad √§r ‚Äúnative VLAN‚Äù och hur b√∂r det hanteras?

N√§mn fyra lager-2-skydd du b√∂r aktivera i accesslagret och deras syfte.

Beskriv skillnaden mellan STP, RSTP och MSTP och n√§r MSTP hj√§lper.

Lista fem saker du alltid kontrollerar n√§r en klient ‚Äúhamnat i fel n√§t‚Äù.

### 

### üîó F√∂rdjupningsl√§nkar

- https://www.cisco.com/c/en/us/support/docs/lan-switching/virtual-lans-vlans/10060-3.html
- https://www.meraki.com/blog/2017/09/vlan-segmentation-best-practices/
- https://www.hpe.com/us/en/networking/tech-vlan.html
- https://www.juniper.net/documentation/en_US/junos/topics/concept/vlan-overview.html
- https://wlanprofessionals.com/resources/ (SSID‚ÜîVLAN och g√§stisolering ‚Äì √∂versikter)

https://www.cisco.com/c/en/us/support/docs/lan-switching/virtual-lans-vlans/10060-3.html

https://www.meraki.com/blog/2017/09/vlan-segmentation-best-practices/

https://www.hpe.com/us/en/networking/tech-vlan.html

https://www.juniper.net/documentation/en_US/junos/topics/concept/vlan-overview.html

https://wlanprofessionals.com/resources/ (SSID‚ÜîVLAN och g√§stisolering ‚Äì √∂versikter)

### 

### ‚úçÔ∏è Egna anteckningar

‚Ä¶


