# 4 Lagring

## 4.10 RAID och LVM ‚Äì Redundans och flexibel lagring

Lagring handlar inte bara om hur mycket utrymme man har ‚Äì utan hur man f√∂rdelar det, s√§krar det och anpassar det f√∂r framtiden. I detta kapitel g√•r vi igenom tv√• tekniker som hj√§lper till med just det: RAID och LVM.


### 4.10.1 Lagringsf√∂rluster och effektiv anv√§ndning

F√∂r att f√∂rst√• RAID och LVM √§r det viktigt att f√∂rst greppa att det alltid finns en skillnad mellan fysisk kapacitet (den storlek som anges p√• en h√•rddisk, t.ex. 2TB) och den tillg√§ngliga kapaciteten som faktiskt kan anv√§ndas i operativsystemet. En del av utrymmet g√•r f√∂rlorat p√• grund av metadata, filsystemets struktur och olika typer av overhead. I RAID-konfigurationer anv√§nds dessutom delar av diskarna f√∂r redundans och felskorrigering, vilket ytterligare minskar det anv√§ndbara utrymmet. Operativsystem och filsystem tar plats, och i redundanssystem som RAID f√∂rloras ocks√• diskar f√∂r att skapa s√§kerhet.

Ett tumregeln √§r att ca 15% f√∂rsvinner till overhead. Den effektiva lagringen kan d√• ber√§knas med formeln:

Effektiv lagring (Ze):

X * Y * 0,85

D√§r:

- X = storlek p√• varje disk
- Y = antal diskar som anv√§nds f√∂r lagring (ej paritet/spegling)

X = storlek p√• varje disk

Y = antal diskar som anv√§nds f√∂r lagring (ej paritet/spegling)

Om du vill veta hur mycket du beh√∂ver k√∂pa f√∂r att f√• ett visst utrymme, anv√§nd: Ze / 0,85 = X * Y


### 4.10.2 Vad √§r RAID?

RAID st√•r f√∂r Redundant Array of Independent Disks. Det inneb√§r att man kopplar samman flera h√•rddiskar f√∂r att de ska samarbeta och f√• antingen h√∂gre prestanda, h√∂gre s√§kerhet ‚Äì eller b√•da.

#### RAID med mjukvara eller h√•rdvara

- H√•rdvaru-RAID sker i en RAID-kontroller som sitter p√• moderkortet eller som separat kort. Operativsystemet ser hela RAID-arrayen som en vanlig disk.
- Mjukvaru-RAID sker i operativsystemet (t.ex. i Linux via mdadm). Det √§r billigare, mer flexibelt, men kan belasta CPU:n mer.

H√•rdvaru-RAID sker i en RAID-kontroller som sitter p√• moderkortet eller som separat kort. Operativsystemet ser hela RAID-arrayen som en vanlig disk.

Mjukvaru-RAID sker i operativsystemet (t.ex. i Linux via mdadm). Det √§r billigare, mer flexibelt, men kan belasta CPU:n mer.


### 4.10.3 RAID-niv√•er

#### JBOD

JBOD st√•r f√∂r Just a Bunch Of Disks, och det √§r precis vad det √§r. Till skillnad fr√•n en RAID s√• f√•r du inte h√∂gre √∂verf√∂ringshastigheter eller redundans. D√§remot f√•r du en l√§nkad volym som kan nyttja alla h√•rddiskars utrymme √§ven om de √§r olika stora

#### RAID 0

Striping utan redundans. Alla diskar skrivs till samtidigt, vilket ger h√∂g prestanda, men om en disk g√•r s√∂nder f√∂rlorar du allt. En av f√∂rdelarna √§r att du kan kombinera olika stora diskar, precis som i JBOD.

- Effektiv lagring: n * X * 0,85
- F√∂rdelar: Snabbt
- Nackdelar: Ingen s√§kerhet

Effektiv lagring: n * X * 0,85

F√∂rdelar: Snabbt

Nackdelar: Ingen s√§kerhet

#### RAID 1

Spegling. Varje disk har en exakt kopia. Om en disk g√•r s√∂nder tar den andra √∂ver. F√∂rdelen h√§r √§r att du direkt har en kopia av den skadade filen, som ers√§tts utan attanv√§ndaren knappt m√§rker det.

- Effektiv lagring: (n / 2) * X * 0,85
- F√∂rdelar: S√§kerhet
- Nackdelar: H√§lften av utrymmet f√∂rsvinner

Effektiv lagring: (n / 2) * X * 0,85

F√∂rdelar: S√§kerhet

Nackdelar: H√§lften av utrymmet f√∂rsvinner

#### RAID 5

Striping med paritet. En disk anv√§nds f√∂r felskorrigeringsdata. Klarar att en disk kraschar. RAID 5 sprider data och distribuerad paritet √∂ver flera diskar. Vid ett diskfel kan allt r√§knas fram igen, men √•teruppbyggnaden √§r l√•ngsammare √§n i RAID 1 eftersom pariteten m√•ste ber√§knas f√∂r varje stripe.

- Effektiv lagring: (n - 1) * X * 0,85
- F√∂rdelar: Bra balans mellan prestanda och s√§kerhet
- Nackdelar: Kan vara segt vid √•teruppbyggnad

Effektiv lagring: (n - 1) * X * 0,85

F√∂rdelar: Bra balans mellan prestanda och s√§kerhet

Nackdelar: Kan vara segt vid √•teruppbyggnad

#### RAID 6

Som RAID 5, men med tv√• paritetsdiskar. Klarar att tv√• diskar kraschar samtidigt.

- Effektiv lagring: (n - 2) * X * 0,85
- F√∂rdelar: Mer s√§kerhet
- Nackdelar: Mindre lagringsyta, l√§gre skrivprestanda

Effektiv lagring: (n - 2) * X * 0,85

F√∂rdelar: Mer s√§kerhet

Nackdelar: Mindre lagringsyta, l√§gre skrivprestanda

#### RAID 10

Kombination av RAID 1 och 0 (f√∂rst spegling, sedan striping). H√∂g prestanda och s√§kerhet, men kr√§ver minst 4 diskar.

- Effektiv lagring: (n / 2) * X * 0,85
- F√∂rdelar: Snabbt och s√§kert
- Nackdelar: Dyrt

Effektiv lagring: (n / 2) * X * 0,85

F√∂rdelar: Snabbt och s√§kert

Nackdelar: Dyrt

#### RAID-kombinationer (t.ex. RAID 50, RAID 55)

I vissa fall bygger man RAID "i flera lager". Exempelvis √§r RAID 50 en kombination av RAID 5 och RAID 0, vilket kan ge h√∂gre prestanda men fortfarande ha viss redundans. En typisk konfiguration kan vara tv√• RAID 5-grupper med vardera fyra diskar (8 totalt), som sedan s√§tts ihop i RAID 0. D√• anv√§nds totalt tv√• diskar till paritet, och sex diskar √§r tillg√§ngliga f√∂r lagring. RAID 55 √§r tv√• RAID 5-arrayer kopplade i spegling (ovanligt, men m√∂jligt) vilket ger h√∂g redundans men kr√§ver m√•nga diskar. I vissa fall bygger man RAID "i flera lager". Exempelvis √§r RAID 50 en kombination av RAID 5 och RAID 0, vilket kan ge h√∂gre prestanda men fortfarande ha viss redundans. RAID 55 √§r tv√• RAID 5-array kopplade i spegling (ovanligt, men m√∂jligt).

üîπ Tips! RAID √§r inte en backup. Det skyddar mot diskkrasch, inte mot radering, virus eller brand.


### 4.10.4 Vad √§r ZFS?

ZFS √§r ett avancerat filsystem som ocks√• hanterar volymer och redundans, likt RAID. Det utvecklades av Sun Microsystems och anv√§nds ofta i servrar och NAS:ar. En av de st√∂rsta f√∂rdelarna med ZFS √§r att det kan ers√§tta b√•de traditionell RAID och LVM i ett och samma system.

ZFS anv√§nder "pools" och sj√§lvreparerande block. Det har inbyggd checksumming, snapshot-funktioner och automatisk korrigering av bitfel.

Vanliga konfigurationer √§r:

- ZFS RAID-Z1 = likt RAID 5
- ZFS RAID-Z2 = likt RAID 6
- ZFS RAID-Z3 = klarar tre diskkrascher

ZFS RAID-Z1 = likt RAID 5

ZFS RAID-Z2 = likt RAID 6

ZFS RAID-Z3 = klarar tre diskkrascher

F√∂rdelar:

- Sj√§lvreparerande
- Snapshot-m√∂jligheter
- Skalbart och flexibelt
- Kan ers√§tta b√•de RAID och LVM

Sj√§lvreparerande

Snapshot-m√∂jligheter

Skalbart och flexibelt

Kan ers√§tta b√•de RAID och LVM

Nackdelar:

- Resurskr√§vande (RAM!)
- Komplicerat att s√§tta upp

Resurskr√§vande (RAM!)

Komplicerat att s√§tta upp


### 4.10.5 Vad √§r LVM?

LVM st√•r f√∂r Logical Volume Manager. Ist√§llet f√∂r att direkt skapa partitioner p√• en fysisk disk, l√§gger LVM till ett extra lager.

LVM best√•r av:

- Fysiska volymer (PV) = t.ex. /dev/sda1
- Volymgrupper (VG) = flera PV bildar en VG
- Logiska volymer (LV) = sj√§lva partitionerna man monterar

Fysiska volymer (PV) = t.ex. /dev/sda1

Volymgrupper (VG) = flera PV bildar en VG

Logiska volymer (LV) = sj√§lva partitionerna man monterar

üîπ Metafor: T√§nk dig ett LEGO-set d√§r du kan bygga om huset (disken) utan att riva allt. Med LVM kan du √§ndra storlek, l√§gga till mer lagring och flytta runt utan att ominstallera.

LVM anv√§nds ofta tillsammans med RAID eller ZFS f√∂r att ge √§nnu st√∂rre flexibilitet och kontroll √∂ver lagringen.

F√∂rdelar:

- Flexibilitet
- Kan √§ndra storlek p√• diskar live
- Snapshot-funktioner

Flexibilitet

Kan √§ndra storlek p√• diskar live

Snapshot-funktioner

Nackdelar:

- Lite mer komplext
- Mjukvarubaserat
- Windowsst√∂d saknas. Windows kan installeras p√• en LV men kan inte hantera LVM

Lite mer komplext

Mjukvarubaserat

Windowsst√∂d saknas. Windows kan installeras p√• en LV men kan inte hantera LVM


### 4.10.6 Exempel fr√•n verkligheten

- Ubuntu Server: Vid installation kan man v√§lja LVM direkt. Kombinera med RAID via mdadm eller ZFS.
- Proxmox: Anv√§nder ofta ZFS som grund, f√∂r snapshots, replikering och s√§ker lagring.
- NAS-l√∂sningar (t.ex. TrueNAS): Anv√§nder ZFS som standard.

Ubuntu Server: Vid installation kan man v√§lja LVM direkt. Kombinera med RAID via mdadm eller ZFS.

Proxmox: Anv√§nder ofta ZFS som grund, f√∂r snapshots, replikering och s√§ker lagring.

NAS-l√∂sningar (t.ex. TrueNAS): Anv√§nder ZFS som standard.


#### 

### 4.10.7 Kontrollfr√•gor

- Vad st√•r RAID f√∂r och vad √§r syftet?
- Hur skiljer sig mjukvaru-RAID fr√•n h√•rdvaru-RAID?
- Vad √§r f√∂r- och nackdelar med RAID 0?
- Hur fungerar RAID 5 och vad h√§nder om en disk g√•r s√∂nder?
- Vad menas med att RAID inte √§r en backup?
- Hur skiljer sig ZFS fr√•n traditionell RAID?
- Vad √§r RAID-Z2?
- Vad √§r LVM och vad √§r f√∂rdelen med att anv√§nda det?
- Vad √§r en volymgrupp inom LVM?
- Ge exempel p√• n√•gon verklig situation d√§r man anv√§nder ZFS.

Vad st√•r RAID f√∂r och vad √§r syftet?

Hur skiljer sig mjukvaru-RAID fr√•n h√•rdvaru-RAID?

Vad √§r f√∂r- och nackdelar med RAID 0?

Hur fungerar RAID 5 och vad h√§nder om en disk g√•r s√∂nder?

Vad menas med att RAID inte √§r en backup?

Hur skiljer sig ZFS fr√•n traditionell RAID?

Vad √§r RAID-Z2?

Vad √§r LVM och vad √§r f√∂rdelen med att anv√§nda det?

Vad √§r en volymgrupp inom LVM?

Ge exempel p√• n√•gon verklig situation d√§r man anv√§nder ZFS.


#### 

### 4.10.8 F√∂rdjupningsl√§nkar

- https://raid.wiki.kernel.org/
- https://help.ubuntu.com/community/Installation/SoftwareRAID
- https://docs.proxmox.com/
- https://openzfs.org/wiki/Main_Page
- https://wiki.archlinux.org/title/LVM

https://raid.wiki.kernel.org/

https://help.ubuntu.com/community/Installation/SoftwareRAID

https://docs.proxmox.com/

https://openzfs.org/wiki/Main_Page

https://wiki.archlinux.org/title/LVM


#### 

### 4.10.9 Egna anteckningar

...



